<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>AWDP | 山 ·	水</title><meta name="author" content="Pax"><meta name="copyright" content="Pax"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="文档收录之AWDPattackhttps://github.com/swisskyrepo/PayloadsAllTheThings 黑白名单php白名单 $input = $_POST['input'];  // 定义输入的白名单正则表达式 $allowedPattern = '/^[a-zA-Z0-9\s]+$/';  // 使用正则表达式匹配输入 if">
<meta property="og:type" content="website">
<meta property="og:title" content="AWDP">
<meta property="og:url" content="http://pax-pq.github.io/AWDP/index.html">
<meta property="og:site_name" content="山 ·	水">
<meta property="og:description" content="文档收录之AWDPattackhttps://github.com/swisskyrepo/PayloadsAllTheThings 黑白名单php白名单 $input = $_POST['input'];  // 定义输入的白名单正则表达式 $allowedPattern = '/^[a-zA-Z0-9\s]+$/';  // 使用正则表达式匹配输入 if">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://pax-pq.github.io/img/smh.png">
<meta property="article:published_time" content="2024-07-26T11:37:43.000Z">
<meta property="article:modified_time" content="2024-07-26T13:02:04.973Z">
<meta property="article:author" content="Pax">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://pax-pq.github.io/img/smh.png"><link rel="shortcut icon" href="/img/favicon.jpg"><link rel="canonical" href="http://pax-pq.github.io/AWDP/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"><link rel="preconnect" href="//busuanzi.ibruce.info"><link rel="stylesheet" href="/css/index.css?v=4.14.0-b3"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.5.1/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.35/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>(()=>{
      const saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
      
      window.btf = {
        saveToLocal: saveToLocal,
        getScript: (url, attr = {}) => new Promise((resolve, reject) => {
          const script = document.createElement('script')
          script.src = url
          script.async = true
          script.onerror = reject
          script.onload = script.onreadystatechange = function() {
            const loadState = this.readyState
            if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
            script.onload = script.onreadystatechange = null
            resolve()
          }

          Object.keys(attr).forEach(key => {
            script.setAttribute(key, attr[key])
          })

          document.head.appendChild(script)
        }),

        getCSS: (url, id = false) => new Promise((resolve, reject) => {
          const link = document.createElement('link')
          link.rel = 'stylesheet'
          link.href = url
          if (id) link.id = id
          link.onerror = reject
          link.onload = link.onreadystatechange = function() {
            const loadState = this.readyState
            if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
            link.onload = link.onreadystatechange = null
            resolve()
          }
          document.head.appendChild(link)
        }),

        addGlobalFn: (key, fn, name = false, parent = window) => {
          const pjaxEnable = true
          if (!pjaxEnable && key.startsWith('pjax')) return

          const globalFn = parent.globalFn || {}
          const keyObj = globalFn[key] || {}
    
          if (name && keyObj[name]) return
    
          name = name || Object.keys(keyObj).length
          keyObj[name] = fn
          globalFn[key] = keyObj
          parent.globalFn = globalFn
        }
      }
    
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode
      
      const t = saveToLocal.get('theme')
    
          const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
          const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
          const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
          const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

          if (t === undefined) {
            if (isLightMode) activateLightMode()
            else if (isDarkMode) activateDarkMode()
            else if (isNotSpecified || hasNoSupport) {
              const now = new Date()
              const hour = now.getHours()
              const isNight = hour <= 6 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            window.matchMedia('(prefers-color-scheme: dark)').addListener(e => {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })()</script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":true,"top_n_per_article":1,"unescape":false,"languages":{"hits_empty":"找不到您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":true,"highlightMacStyle":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"limitCount":50,"languages":{"author":"作者: Pax","link":"链接: ","source":"来源: 山 ·\t水","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  lightbox: 'fancybox',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid@4.11.1/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'AWDP',
  isPost: false,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2024-07-26 21:02:04'
}</script><link rel="stylesheet" href="APlayer.min.css"></head><body><div id="aplayer"></div><script src="https://cdn.jsdelivr.net/gh/radium-bit/res@master/live2d/autoload.js" async=""></script><script src="https://cdn.jsdelivr.net/npm/meting@2/dist/Meting.min.js" async=""></script><link rel="stylesheet" href="/css/rain-effect.css"><script src="/js/rain-effect.js"></script><link rel="stylesheet" href="/css/xxx.css"><link rel="stylesheet" href="/css/cursor.css"><link rel="stylesheet" href="/css/loadin.css"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/js-heo@1.0.11/mainColor/heoMainColor.css"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/js-heo@1.0.11/poem/poem.css"><link rel="stylesheet" href="/css/dhl.css"><link rel="stylesheet" href="/css/dark_read.css"><link rel="stylesheet" href="/css/rain-effect.css"><link rel="stylesheet" href="/css/font/font.css"><link rel="stylesheet" href="/css/menu.css"><link rel="stylesheet" href="/css/custom.css"><meta name="generator" content="Hexo 7.1.1"><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="scarecrow"><div class="scarecrow__hat"><div class="scarecrow__ribbon"></div></div><div class="scarecrow__head"><div class="scarecrow__eye"></div><div class="scarecrow__eye"></div><div class="scarecrow__mouth"></div><div class="scarecrow__pipe"></div></div><div class="scarecrow__body"><div class="scarecrow__glove scarecrow__glove--l"></div><div class="scarecrow__sleeve scarecrow__sleeve--l"></div><div class="scarecrow__bow"></div><div class="scarecrow__shirt"></div><div class="scarecrow__coat"></div><div class="scarecrow__waistcoat"></div><div class="scarecrow__sleeve scarecrow__sleeve--r"></div><div class="scarecrow__glove scarecrow__glove--r"></div><div class="scarecrow__coattails"></div><div class="scarecrow__pants"></div></div><div class="scarecrow__arms"></div><div class="scarecrow__leg">  </div></div></div><script>(()=>{
  const $loadingBox = document.getElementById('loading-box')
  const $body = document.body
  const preloader = {
    endLoading: () => {
      $body.style.overflow = ''
      $loadingBox.classList.add('loaded')
    },
    initLoading: () => {
      $body.style.overflow = 'hidden'
      $loadingBox.classList.remove('loaded')
    }
  }

  preloader.initLoading()
  window.addEventListener('load',() => { preloader.endLoading() })

  if (true) {
    btf.addGlobalFn('pjaxSend', () => { preloader.initLoading() }, 'preloader_init')
    btf.addGlobalFn('pjaxComplete', () => { preloader.endLoading() }, 'preloader_end')
  }
})()</script><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/smh.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">32</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">10</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">22</div></a></div><hr class="custom-hr"><div class="menus_items"><div class="menus_item"><span class="site-page group"><i class="fa-fw fa-solid fa-bars"></i><span> 收录</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/AWDP/"><i class="fa-fw fas fa-book"></i><span> AWDP</span></a></li></ul></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fa fa-graduation-cap"></i><span> 书院</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/categories/"><i class="fa-fw fa fa-archive"></i><span> 分类</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/archives/"><i class="fa-fw fa fa-history"></i><span> 溯流</span></a></li></ul></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-edit"></i><span> 日学</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/2024/"><i class="fa-fw fas fa-calendar"></i><span> 2024</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-vihara"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-user-friends"></i><span> 友座</span></a></div><div class="menus_item"><a class="site-page" href="/poem/"><i class="fa-fw far fa-edit"></i><span> 诗壁</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fa-brands fa-free-code-camp"></i><span> 清欢</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> 天籁</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 光影</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 明镜</span></a></div></div></div></div><div class="page" id="body-wrap"><header class="not-home-page" id="page-header" style="background-image: url('/img/page_img4.png')"><nav id="nav"><span id="blog-info"><a href="/" title="山 ·	水"><span class="site-name">山 ·	水</span></a></span><div id="menus"><div id="search-button"><span class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></span></div><div class="menus_items"><div class="menus_item"><span class="site-page group"><i class="fa-fw fa-solid fa-bars"></i><span> 收录</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/AWDP/"><i class="fa-fw fas fa-book"></i><span> AWDP</span></a></li></ul></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fa fa-graduation-cap"></i><span> 书院</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/categories/"><i class="fa-fw fa fa-archive"></i><span> 分类</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/archives/"><i class="fa-fw fa fa-history"></i><span> 溯流</span></a></li></ul></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-edit"></i><span> 日学</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/2024/"><i class="fa-fw fas fa-calendar"></i><span> 2024</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-vihara"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-user-friends"></i><span> 友座</span></a></div><div class="menus_item"><a class="site-page" href="/poem/"><i class="fa-fw far fa-edit"></i><span> 诗壁</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fa-brands fa-free-code-camp"></i><span> 清欢</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> 天籁</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 光影</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 明镜</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="page-site-info"><h1 id="site-title">AWDP</h1></div></header><main class="layout" id="content-inner"><div id="page"><div class="top-img" style="background-image: url('/img/page_img4.png');"></div><div id="article-container"><h1 id="文档收录之AWDP"><a href="#文档收录之AWDP" class="headerlink" title="文档收录之AWDP"></a>文档收录之AWDP</h1><h2 id="attack"><a href="#attack" class="headerlink" title="attack"></a>attack</h2><p><a target="_blank" rel="noopener" href="https://github.com/swisskyrepo/PayloadsAllTheThings">https://github.com/swisskyrepo/PayloadsAllTheThings</a></p>
<h2 id="黑白名单"><a href="#黑白名单" class="headerlink" title="黑白名单"></a>黑白名单</h2><h3 id="php"><a href="#php" class="headerlink" title="php"></a>php</h3><p>白名单</p>
<pre><code class="highlight php"><span class="variable">$input</span> = <span class="variable">$_POST</span>[<span class="string">'input'</span>];

<span class="comment">// 定义输入的白名单正则表达式</span>
<span class="variable">$allowedPattern</span> = <span class="string">'/^[a-zA-Z0-9\s]+$/'</span>;

<span class="comment">// 使用正则表达式匹配输入</span>
<span class="keyword">if</span> (!<span class="title function_ invoke__">preg_match</span>(<span class="variable">$allowedPattern</span>, <span class="variable">$input</span>)) {
    <span class="comment">// 输入不符合白名单规则，直接退出或进行其他相应操作</span>
    <span class="keyword">return</span>;
}

<span class="comment">// 输入符合白名单规则，继续后续处理</span>
<span class="comment">// ...</span></code></pre>

<p>黑名单</p>
<pre><code class="highlight php"><span class="variable">$input</span> = <span class="variable">$_POST</span>[<span class="string">'input'</span>]; <span class="comment">// 获取输入数据</span>
<span class="variable">$blacklist</span> = [<span class="string">'blacklist'</span>, <span class="string">'word1'</span>, <span class="string">'word2'</span>]; <span class="comment">// 定义黑名单数组</span>

<span class="keyword">foreach</span> (<span class="variable">$blacklist</span> <span class="keyword">as</span> <span class="variable">$word</span>) {
    <span class="keyword">if</span> (<span class="title function_ invoke__">stripos</span>(<span class="variable">$input</span>, <span class="variable">$word</span>) !== <span class="literal">false</span>) {
        <span class="comment">// 输入中存在黑名单词汇，直接返回或执行其他相应操作</span>
        <span class="keyword">return</span>;
    }
}

<span class="comment">// 输入安全，继续处理</span>
<span class="comment">// ...</span></code></pre>

<h3 id="java"><a href="#java" class="headerlink" title="java"></a>java</h3><p>白</p>
<pre><code class="highlight java"><span class="keyword">import</span> java.util.regex.Pattern;

<span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">InputOutputValidator</span> {
    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Pattern</span> <span class="variable">ALLOWED_PATTERN</span> <span class="operator">=</span> Pattern.compile(<span class="string">"^[a-zA-Z0-9\\s]+$"</span>);

    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> {
        <span class="type">String</span> <span class="variable">input</span> <span class="operator">=</span> <span class="string">"Some input data"</span>;

        <span class="keyword">if</span> (!ALLOWED_PATTERN.matcher(input).matches()) {
            <span class="comment">// 输入不符合白名单规则，直接退出或进行其他相应操作</span>
            System.exit(<span class="number">1</span>); <span class="comment">// 退出程序，返回错误状态码</span>
        }

        <span class="comment">// 输入符合白名单规则，继续后续处理</span>
        <span class="comment">// ...</span>
    }
}</code></pre>

<p>黑</p>
<pre><code class="highlight java"><span class="keyword">import</span> java.util.Arrays;
<span class="keyword">import</span> java.util.List;

<span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BlacklistExample</span> {
    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> {
        List&lt;String&gt; blacklist = Arrays.asList(<span class="string">"blacklist"</span>, <span class="string">"restricted"</span>, <span class="string">"blocked"</span>);

        <span class="type">String</span> <span class="variable">input</span> <span class="operator">=</span> <span class="string">"Some input with blacklist word"</span>;

        <span class="keyword">for</span> (String word : blacklist) {
            <span class="keyword">if</span> (input.contains(word)) {
                <span class="comment">// 输入中存在黑名单词汇，直接退出或进行其他相应操作</span>
                System.exit(<span class="number">1</span>); <span class="comment">// 退出程序，返回错误状态码</span>
            }
        }

        <span class="comment">// 输入不包含黑名单词汇，继续后续处理</span>
        <span class="comment">// ...</span>
    }
}</code></pre>

<h3 id="nodejs"><a href="#nodejs" class="headerlink" title="nodejs"></a>nodejs</h3><p>白</p>
<pre><code class="highlight javascript"><span class="keyword">const</span> allowedPattern = <span class="regexp">/^[a-zA-Z0-9\s]+$/</span>;

<span class="keyword">const</span> input = <span class="string">'Some input data'</span>;

<span class="keyword">if</span> (!allowedPattern.<span class="title function_">test</span>(input)) {
  <span class="comment">// 输入不符合白名单规则，直接退出或进行其他相应操作</span>
  process.<span class="title function_">exit</span>(<span class="number">1</span>); <span class="comment">// 退出程序，返回错误状态码</span>
}

<span class="comment">// 输入符合白名单规则，继续后续处理</span>
<span class="comment">// ...</span></code></pre>

<p>黑</p>
<pre><code class="highlight javascript"><span class="keyword">const</span> blacklist = [<span class="string">'blacklist'</span>, <span class="string">'restricted'</span>, <span class="string">'blocked'</span>];

<span class="keyword">const</span> input = <span class="string">'Some input with blacklist word'</span>;

<span class="keyword">for</span> (<span class="keyword">const</span> word <span class="keyword">of</span> blacklist) {
  <span class="keyword">if</span> (input.<span class="title function_">includes</span>(word)) {
    <span class="comment">// 输入中存在黑名单词汇，直接退出或进行其他相应操作</span>
    process.<span class="title function_">exit</span>(<span class="number">1</span>); <span class="comment">// 退出程序，返回错误状态码</span>
  }
}

<span class="comment">// 输入不包含黑名单词汇，继续后续处理</span>
<span class="comment">// ...</span></code></pre>

<h3 id="python"><a href="#python" class="headerlink" title="python"></a>python</h3><p>白</p>
<pre><code class="highlight python"><span class="keyword">import</span> re
<span class="keyword">import</span> sys

allowed_pattern = <span class="string">r'^[a-zA-Z0-9\s]+$'</span>

input_data = <span class="string">'Some input data'</span>

<span class="keyword">if</span> <span class="keyword">not</span> re.<span class="keyword">match</span>(allowed_pattern, input_data):
    <span class="comment"># 输入不符合白名单规则，直接退出或进行其他相应操作</span>
    sys.exit(<span class="number">1</span>)  <span class="comment"># 退出程序，返回错误状态码</span>

<span class="comment"># 输入符合白名单规则，继续后续处理</span>
<span class="comment"># ...</span></code></pre>

<p>黑</p>
<pre><code class="highlight python">blacklist = [<span class="string">'blacklist'</span>, <span class="string">'restricted'</span>, <span class="string">'blocked'</span>]

input_data = <span class="string">'Some input with blacklist word'</span>

<span class="keyword">for</span> word <span class="keyword">in</span> blacklist:
    <span class="keyword">if</span> word <span class="keyword">in</span> input_data:
        <span class="comment"># 输入中存在黑名单词汇，直接退出或进行其他相应操作</span>
        exit(<span class="number">1</span>)  <span class="comment"># 退出程序，返回错误状态码</span>

<span class="comment"># 输入不包含黑名单词汇，继续后续处理</span>
<span class="comment"># ...</span></code></pre>

<h2 id="字符串替换"><a href="#字符串替换" class="headerlink" title="字符串替换"></a>字符串替换</h2><p>下面是各个语言中字符串替换函数的示例代码：</p>
<h3 id="PHP："><a href="#PHP：" class="headerlink" title="PHP："></a>PHP：</h3><pre><code class="highlight php">phpCopy code<span class="variable">$input</span> = <span class="string">"Hello, World!"</span>;
<span class="variable">$replacement</span> = <span class="string">"John"</span>;
<span class="variable">$output</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">"World"</span>, <span class="variable">$replacement</span>, <span class="variable">$input</span>);
<span class="keyword">echo</span> <span class="variable">$output</span>;</code></pre>

<h3 id="Python："><a href="#Python：" class="headerlink" title="Python："></a>Python：</h3><pre><code class="highlight python">pythonCopy codeinput_str = <span class="string">"Hello, World!"</span>
replacement = <span class="string">"John"</span>
output = input_str.replace(<span class="string">"World"</span>, replacement)
<span class="built_in">print</span>(output)</code></pre>

<h3 id="Java："><a href="#Java：" class="headerlink" title="Java："></a>Java：</h3><pre><code class="highlight java">javaCopy <span class="type">codeString</span> <span class="variable">input</span> <span class="operator">=</span> <span class="string">"Hello, World!"</span>;
<span class="type">String</span> <span class="variable">replacement</span> <span class="operator">=</span> <span class="string">"John"</span>;
<span class="type">String</span> <span class="variable">output</span> <span class="operator">=</span> input.replace(<span class="string">"World"</span>, replacement);
System.out.println(output);</code></pre>

<h3 id="Node-js："><a href="#Node-js：" class="headerlink" title="Node.js："></a>Node.js：</h3><pre><code class="highlight javascript">javascriptCopy codeconst input = <span class="string">"Hello, World!"</span>;
<span class="keyword">const</span> replacement = <span class="string">"John"</span>;
<span class="keyword">const</span> output = input.<span class="title function_">replace</span>(<span class="string">"World"</span>, replacement);
<span class="variable language_">console</span>.<span class="title function_">log</span>(output);</code></pre>

<p>这些示例代码都使用了各自语言中的字符串替换函数。在这里，我们使用了 <code>str_replace()</code> 函数（PHP）、<code>replace()</code> 方法（Python）、<code>replace()</code> 方法（Java）以及 <code>replace()</code> 方法（Node.js）来替换字符串中的特定部分。</p>
<p>替换函数的基本语法如下：</p>
<p>PHP：<code>str_replace(search, replace, subject)</code> Python：<code>replace(old, new[, count])</code> Java：<code>replace(CharSequence target, CharSequence replacement)</code> Node.js：<code>replace(regexp|substr, newSubstr|function)</code></p>
<p>这些函数都会在字符串中搜索指定的子字符串（或正则表达式），并将其替换为新的字符串。你可以根据具体的需求和语言选择适合的字符串替换函数来进行操作。</p>
<h2 id="SQLi"><a href="#SQLi" class="headerlink" title="SQLi"></a>SQLi</h2><h3 id="php-1"><a href="#php-1" class="headerlink" title="php"></a>php</h3><h4 id="mysqli"><a href="#mysqli" class="headerlink" title="mysqli"></a>mysqli</h4><p>vul</p>
<pre><code class="highlight php"><span class="comment">// 使用不安全的方式构建 SQL 查询</span>
<span class="variable">$unsafeVariable</span> = <span class="variable">$_POST</span>[<span class="string">'user_input'</span>];
<span class="variable">$query</span> = <span class="string">"SELECT * FROM users WHERE username = '<span class="subst">$unsafeVariable</span>'"</span>;

<span class="comment">// 执行 SQL 查询</span>
<span class="variable">$result</span> = <span class="title function_ invoke__">mysqli_query</span>(<span class="variable">$connection</span>, <span class="variable">$query</span>);</code></pre>

<p>fix</p>
<pre><code class="highlight php"><span class="comment">// 使用预处理语句构建安全的 SQL 查询</span>
<span class="variable">$unsafeVariable</span> = <span class="variable">$_POST</span>[<span class="string">'user_input'</span>];
<span class="variable">$query</span> = <span class="string">"SELECT * FROM users WHERE username = ?"</span>;
<span class="variable">$statement</span> = <span class="variable">$connection</span>-&gt;<span class="title function_ invoke__">prepare</span>(<span class="variable">$query</span>);
<span class="variable">$statement</span>-&gt;<span class="title function_ invoke__">bind_param</span>(<span class="string">"s"</span>, <span class="variable">$unsafeVariable</span>);

<span class="comment">// 执行 SQL 查询</span>
<span class="variable">$statement</span>-&gt;<span class="title function_ invoke__">execute</span>();
<span class="variable">$result</span> = <span class="variable">$statement</span>-&gt;<span class="title function_ invoke__">get_result</span>();</code></pre>

<h4 id="PDO"><a href="#PDO" class="headerlink" title="PDO"></a>PDO</h4><p>vul</p>
<pre><code class="highlight php"><span class="comment">// 使用不安全的方式构建 SQL 查询</span>
<span class="variable">$unsafeVariable</span> = <span class="variable">$_POST</span>[<span class="string">'user_input'</span>];
<span class="variable">$query</span> = <span class="string">"SELECT * FROM users WHERE username = '<span class="subst">$unsafeVariable</span>'"</span>;

<span class="comment">// 执行 SQL 查询</span>
<span class="variable">$result</span> = <span class="variable">$pdo</span>-&gt;<span class="title function_ invoke__">query</span>(<span class="variable">$query</span>);</code></pre>

<p>fix</p>
<pre><code class="highlight php"><span class="comment">// 使用参数化查询构建安全的 SQL 查询</span>
<span class="variable">$unsafeVariable</span> = <span class="variable">$_POST</span>[<span class="string">'user_input'</span>];
<span class="variable">$query</span> = <span class="string">"SELECT * FROM users WHERE username = :username"</span>;
<span class="variable">$statement</span> = <span class="variable">$pdo</span>-&gt;<span class="title function_ invoke__">prepare</span>(<span class="variable">$query</span>);
<span class="variable">$statement</span>-&gt;<span class="title function_ invoke__">bindParam</span>(<span class="string">':username'</span>, <span class="variable">$unsafeVariable</span>);

<span class="comment">// 执行 SQL 查询</span>
<span class="variable">$statement</span>-&gt;<span class="title function_ invoke__">execute</span>();
<span class="variable">$result</span> = <span class="variable">$statement</span>-&gt;<span class="title function_ invoke__">fetchAll</span>();</code></pre>

<h4 id="mysql"><a href="#mysql" class="headerlink" title="mysql"></a>mysql</h4><p>vul</p>
<pre><code class="highlight php"><span class="comment">// 使用不安全的方式构建 SQL 查询</span>
<span class="variable">$unsafeVariable</span> = <span class="variable">$_POST</span>[<span class="string">'user_input'</span>];
<span class="variable">$query</span> = <span class="string">"SELECT * FROM users WHERE username = '<span class="subst">$unsafeVariable</span>'"</span>;

<span class="comment">// 执行 SQL 查询</span>
<span class="variable">$result</span> = <span class="title function_ invoke__">mysql_query</span>(<span class="variable">$query</span>, <span class="variable">$connection</span>);</code></pre>

<p>fix</p>
<pre><code class="highlight php"><span class="comment">// 使用预处理语句构建安全的 SQL 查询</span>
<span class="variable">$unsafeVariable</span> = <span class="variable">$_POST</span>[<span class="string">'user_input'</span>];
<span class="variable">$query</span> = <span class="string">"SELECT * FROM users WHERE username = ?"</span>;
<span class="variable">$statement</span> = <span class="title function_ invoke__">mysql_stmt_init</span>(<span class="variable">$connection</span>);
<span class="title function_ invoke__">mysql_stmt_prepare</span>(<span class="variable">$statement</span>, <span class="variable">$query</span>);
<span class="title function_ invoke__">mysql_stmt_bind_param</span>(<span class="variable">$statement</span>, <span class="string">'s'</span>, <span class="variable">$unsafeVariable</span>);

<span class="comment">// 执行 SQL 查询</span>
<span class="title function_ invoke__">mysql_stmt_execute</span>(<span class="variable">$statement</span>);
<span class="variable">$result</span> = <span class="title function_ invoke__">mysql_stmt_get_result</span>(<span class="variable">$statement</span>);</code></pre>

<h3 id="java-1"><a href="#java-1" class="headerlink" title="java"></a>java</h3><h4 id="JDBC"><a href="#JDBC" class="headerlink" title="JDBC"></a>JDBC</h4><p>vul</p>
<pre><code class="highlight java"><span class="comment">// 使用不安全的方式构建 SQL 查询</span>
<span class="type">String</span> <span class="variable">unsafeVariable</span> <span class="operator">=</span> request.getParameter(<span class="string">"user_input"</span>);
<span class="type">String</span> <span class="variable">query</span> <span class="operator">=</span> <span class="string">"SELECT * FROM users WHERE username = '"</span> + unsafeVariable + <span class="string">"'"</span>;

<span class="comment">// 执行 SQL 查询</span>
<span class="type">Statement</span> <span class="variable">statement</span> <span class="operator">=</span> connection.createStatement();
<span class="type">ResultSet</span> <span class="variable">result</span> <span class="operator">=</span> statement.executeQuery(query);
</code></pre>

<p>fix</p>
<pre><code class="highlight java"><span class="comment">// 使用预编译语句构建安全的 SQL 查询</span>
<span class="type">String</span> <span class="variable">unsafeVariable</span> <span class="operator">=</span> request.getParameter(<span class="string">"user_input"</span>);
<span class="type">String</span> <span class="variable">query</span> <span class="operator">=</span> <span class="string">"SELECT * FROM users WHERE username = ?"</span>;
<span class="type">PreparedStatement</span> <span class="variable">statement</span> <span class="operator">=</span> connection.prepareStatement(query);
statement.setString(<span class="number">1</span>, unsafeVariable);

<span class="comment">// 执行 SQL 查询</span>
<span class="type">ResultSet</span> <span class="variable">result</span> <span class="operator">=</span> statement.executeQuery();
</code></pre>

<h4 id="ORM"><a href="#ORM" class="headerlink" title="ORM"></a>ORM</h4><p>fix</p>
<pre><code class="highlight java"><span class="comment">// 使用不安全的方式构建 SQL 查询</span>
<span class="type">String</span> <span class="variable">unsafeVariable</span> <span class="operator">=</span> request.getParameter(<span class="string">"user_input"</span>);
<span class="type">String</span> <span class="variable">query</span> <span class="operator">=</span> <span class="string">"SELECT * FROM users WHERE username = '"</span> + unsafeVariable + <span class="string">"'"</span>;

<span class="comment">// 执行 SQL 查询</span>
<span class="type">Query</span> <span class="variable">hibernateQuery</span> <span class="operator">=</span> session.createSQLQuery(query);
List&lt;Object[]&gt; result = hibernateQuery.list();</code></pre>

<p>fix</p>
<pre><code class="highlight java"><span class="comment">// 使用命名参数构建安全的 SQL 查询</span>
<span class="type">String</span> <span class="variable">unsafeVariable</span> <span class="operator">=</span> request.getParameter(<span class="string">"user_input"</span>);
<span class="type">String</span> <span class="variable">query</span> <span class="operator">=</span> <span class="string">"SELECT * FROM users WHERE username = :username"</span>;
<span class="type">Query</span> <span class="variable">hibernateQuery</span> <span class="operator">=</span> session.createSQLQuery(query);
hibernateQuery.setParameter(<span class="string">"username"</span>, unsafeVariable);
List&lt;Object[]&gt; result = hibernateQuery.list();</code></pre>

<h3 id="nodejs-1"><a href="#nodejs-1" class="headerlink" title="nodejs"></a>nodejs</h3><h4 id="mysql-1"><a href="#mysql-1" class="headerlink" title="mysql"></a>mysql</h4><p>vul</p>
<pre><code class="highlight javascript"><span class="comment">// 使用不安全的方式构建 SQL 查询</span>
<span class="keyword">const</span> unsafeVariable = req.<span class="property">body</span>.<span class="property">user_input</span>;
<span class="keyword">const</span> query = <span class="string">`SELECT * FROM users WHERE username = '<span class="subst">${unsafeVariable}</span>'`</span>;

<span class="comment">// 执行 SQL 查询</span>
mysqlConnection.<span class="title function_">query</span>(query, <span class="function">(<span class="params">error, result</span>) =&gt;</span> {
  <span class="comment">// 处理结果</span>
});
</code></pre>

<p>fix</p>
<pre><code class="highlight javascript"><span class="comment">// 使用参数绑定构建安全的 SQL 查询</span>
<span class="keyword">const</span> unsafeVariable = req.<span class="property">body</span>.<span class="property">user_input</span>;
<span class="keyword">const</span> query = <span class="string">"SELECT * FROM users WHERE username = ?"</span>;

<span class="comment">// 执行 SQL 查询</span>
mysqlConnection.<span class="title function_">query</span>(query, [unsafeVariable], <span class="function">(<span class="params">error, result</span>) =&gt;</span> {
  <span class="comment">// 处理结果</span>
});
</code></pre>

<h4 id="mysql2"><a href="#mysql2" class="headerlink" title="mysql2"></a>mysql2</h4><p>vul</p>
<pre><code class="highlight java"><span class="comment">// 使用不安全的方式构建 SQL 查询</span>
<span class="type">const</span> <span class="variable">unsafeVariable</span> <span class="operator">=</span> req.body.user_input;
<span class="type">const</span> <span class="variable">query</span> <span class="operator">=</span> `SELECT * FROM users <span class="type">WHERE</span> <span class="variable">username</span> <span class="operator">=</span> <span class="string">'${unsafeVariable}'</span>`;

<span class="comment">// 执行 SQL 查询</span>
mysql2Connection.query(query, (error, result) =&gt; {
  <span class="comment">// 处理结果</span>
});</code></pre>

<p>fix</p>
<pre><code class="highlight javascript"><span class="comment">// 使用参数绑定构建安全的 SQL 查询</span>
<span class="keyword">const</span> unsafeVariable = req.<span class="property">body</span>.<span class="property">user_input</span>;
<span class="keyword">const</span> query = <span class="string">"SELECT * FROM users WHERE username = ?"</span>;

<span class="comment">// 执行 SQL 查询</span>
mysql2Connection.<span class="title function_">query</span>(query, [unsafeVariable], <span class="function">(<span class="params">error, result</span>) =&gt;</span> {
  <span class="comment">// 处理结果</span>
});</code></pre>

<h4 id="Sequelize"><a href="#Sequelize" class="headerlink" title="Sequelize"></a>Sequelize</h4><p>vul</p>
<pre><code class="highlight java"><span class="comment">// 使用不安全的方式构建 SQL 查询</span>
<span class="type">const</span> <span class="variable">unsafeVariable</span> <span class="operator">=</span> req.body.user_input;
<span class="type">const</span> <span class="variable">query</span> <span class="operator">=</span> `SELECT * FROM users <span class="type">WHERE</span> <span class="variable">username</span> <span class="operator">=</span> <span class="string">'${unsafeVariable}'</span>`;

<span class="comment">// 执行 SQL 查询</span>
sequelize.query(query).then((result) =&gt; {
  <span class="comment">// 处理结果</span>
}).<span class="keyword">catch</span>((error) =&gt; {
  <span class="comment">// 处理错误</span>
});</code></pre>

<p>fix</p>
<pre><code class="highlight javascript"><span class="comment">// 使用参数绑定构建安全的 SQL 查询</span>
<span class="keyword">const</span> unsafeVariable = req.<span class="property">body</span>.<span class="property">user_input</span>;
<span class="keyword">const</span> query = <span class="string">"SELECT * FROM users WHERE username = :username"</span>;

<span class="comment">// 执行 SQL 查询</span>
sequelize.<span class="title function_">query</span>(query, { <span class="attr">replacements</span>: { <span class="attr">username</span>: unsafeVariable } }).<span class="title function_">then</span>(<span class="function">(<span class="params">result</span>) =&gt;</span> {
  <span class="comment">// 处理结果</span>
}).<span class="title function_">catch</span>(<span class="function">(<span class="params">error</span>) =&gt;</span> {
  <span class="comment">// 处理错误</span>
});</code></pre>





<h3 id="python-1"><a href="#python-1" class="headerlink" title="python"></a>python</h3><h4 id="MySQLdb"><a href="#MySQLdb" class="headerlink" title="MySQLdb"></a>MySQLdb</h4><p>vul</p>
<pre><code class="highlight python"><span class="keyword">import</span> MySQLdb

<span class="comment"># 使用不安全的方式构建 SQL 查询</span>
unsafeVariable = <span class="built_in">input</span>(<span class="string">"请输入用户名："</span>)
query = <span class="string">"SELECT * FROM users WHERE username = '"</span> + unsafeVariable + <span class="string">"'"</span>

<span class="comment"># 执行 SQL 查询</span>
connection = MySQLdb.connect(host=<span class="string">"localhost"</span>, user=<span class="string">"root"</span>, password=<span class="string">"password"</span>, db=<span class="string">"database"</span>)
cursor = connection.cursor()
cursor.execute(query)
</code></pre>

<p>fix</p>
<pre><code class="highlight python"><span class="keyword">import</span> MySQLdb

<span class="comment"># 使用参数化查询构建安全的 SQL 查询</span>
unsafeVariable = <span class="built_in">input</span>(<span class="string">"请输入用户名："</span>)
query = <span class="string">"SELECT * FROM users WHERE username = %s"</span>

<span class="comment"># 执行 SQL 查询</span>
connection = MySQLdb.connect(host=<span class="string">"localhost"</span>, user=<span class="string">"root"</span>, password=<span class="string">"password"</span>, db=<span class="string">"database"</span>)
cursor = connection.cursor()
cursor.execute(query, (unsafeVariable,))</code></pre>

<h4 id="PyMySQL"><a href="#PyMySQL" class="headerlink" title="PyMySQL"></a>PyMySQL</h4><p>vul</p>
<pre><code class="highlight java"><span class="keyword">import</span> pymysql

# 使用不安全的方式构建 SQL 查询
unsafeVariable = input(<span class="string">"请输入用户名："</span>)
query = <span class="string">"SELECT * FROM users WHERE username = '"</span> + unsafeVariable + <span class="string">"'"</span>

# 执行 SQL 查询
connection = pymysql.connect(host=<span class="string">"localhost"</span>, user=<span class="string">"root"</span>, password=<span class="string">"password"</span>, db=<span class="string">"database"</span>)
cursor = connection.cursor()
cursor.execute(query)</code></pre>

<p>fix</p>
<pre><code class="highlight python"><span class="keyword">import</span> pymysql

<span class="comment"># 使用参数化查询构建安全的 SQL 查询</span>
unsafeVariable = <span class="built_in">input</span>(<span class="string">"请输入用户名："</span>)
query = <span class="string">"SELECT * FROM users WHERE username = %s"</span>

<span class="comment"># 执行 SQL 查询</span>
connection = pymysql.connect(host=<span class="string">"localhost"</span>, user=<span class="string">"root"</span>, password=<span class="string">"password"</span>, db=<span class="string">"database"</span>)
cursor = connection.cursor()
cursor.execute(query, (unsafeVariable,))</code></pre>

<h4 id="mysql-connector-python"><a href="#mysql-connector-python" class="headerlink" title="mysql-connector-python"></a>mysql-connector-python</h4><pre><code class="highlight python"><span class="keyword">import</span> mysql.connector

<span class="comment"># 使用不安全的方式构建 SQL 查询</span>
unsafeVariable = <span class="built_in">input</span>(<span class="string">"请输入用户名："</span>)
query = <span class="string">"SELECT * FROM users WHERE username = '"</span> + unsafeVariable + <span class="string">"'"</span>

<span class="comment"># 执行 SQL 查询</span>
connection = mysql.connector.connect(host=<span class="string">"localhost"</span>, user=<span class="string">"root"</span>, password=<span class="string">"password"</span>, database=<span class="string">"database"</span>)
cursor = connection.cursor()
cursor.execute(query)</code></pre>

<p>fix</p>
<pre><code class="highlight python"><span class="keyword">import</span> mysql.connector

<span class="comment"># 使用参数化查询构建安全的 SQL 查询</span>
unsafeVariable = <span class="built_in">input</span>(<span class="string">"请输入用户名："</span>)
query = <span class="string">"SELECT * FROM users WHERE username = %s"</span>

<span class="comment"># 执行 SQL 查询</span>
connection = mysql.connector.connect(host=<span class="string">"localhost"</span>, user=<span class="string">"root"</span>, password=<span class="string">"password"</span>, database=<span class="string">"database"</span>)
cursor = connection.cursor()
cursor.execute(query, (unsafeVariable,))</code></pre>



<h2 id="XSS"><a href="#XSS" class="headerlink" title="XSS"></a>XSS</h2><h3 id="php-2"><a href="#php-2" class="headerlink" title="php"></a>php</h3><p>vul</p>
<pre><code class="highlight php"><span class="meta">&lt;?php</span>
<span class="variable">$userInput</span> = <span class="variable">$_GET</span>[<span class="string">'input'</span>];
<span class="keyword">echo</span> <span class="variable">$userInput</span>;
<span class="meta">?&gt;</span></code></pre>

<p>fix</p>
<pre><code class="highlight php"><span class="meta">&lt;?php</span>
<span class="variable">$userInput</span> = <span class="variable">$_GET</span>[<span class="string">'input'</span>];
<span class="keyword">echo</span> <span class="title function_ invoke__">htmlspecialchars</span>(<span class="variable">$userInput</span>, ENT_QUOTES, <span class="string">'UTF-8'</span>);
<span class="meta">?&gt;</span></code></pre>

<h3 id="java-2"><a href="#java-2" class="headerlink" title="java"></a>java</h3><h4 id="示例1"><a href="#示例1" class="headerlink" title="示例1"></a>示例1</h4><p>vul</p>
<pre><code class="highlight java"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;
<span class="keyword">import</span> org.springframework.web.bind.annotation.RequestParam;
<span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;

<span class="meta">@RestController</span>
<span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">InputController</span> {

    <span class="meta">@GetMapping("/input")</span>
    <span class="keyword">public</span> String <span class="title function_">handleInput</span><span class="params">(<span class="meta">@RequestParam("input")</span> String userInput)</span> {
        <span class="keyword">return</span> userInput;
    }
}</code></pre>

<p>fix</p>
<pre><code class="highlight java"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;
<span class="keyword">import</span> org.springframework.web.bind.annotation.RequestParam;
<span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;
<span class="keyword">import</span> org.springframework.web.util.HtmlUtils;

<span class="meta">@RestController</span>
<span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">InputController</span> {

    <span class="meta">@GetMapping("/input")</span>
    <span class="keyword">public</span> String <span class="title function_">handleInput</span><span class="params">(<span class="meta">@RequestParam("input")</span> String userInput)</span> {
        <span class="keyword">return</span> HtmlUtils.htmlEscape(userInput);
    }
}</code></pre>

<h4 id="示例2"><a href="#示例2" class="headerlink" title="示例2"></a>示例2</h4><p>vul</p>
<pre><code class="highlight java"><span class="keyword">import</span> org.springframework.stereotype.Controller;
<span class="keyword">import</span> org.springframework.ui.Model;
<span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;
<span class="keyword">import</span> org.springframework.web.bind.annotation.RequestParam;

<span class="meta">@Controller</span>
<span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">InputController</span> {

    <span class="meta">@GetMapping("/input")</span>
    <span class="keyword">public</span> String <span class="title function_">handleInput</span><span class="params">(<span class="meta">@RequestParam("input")</span> String userInput, Model model)</span> {
        model.addAttribute(<span class="string">"userInput"</span>, userInput);
        <span class="keyword">return</span> <span class="string">"input-template"</span>;
    }
}</code></pre>

<p>fix</p>
<pre><code class="highlight java"><span class="keyword">import</span> org.springframework.stereotype.Controller;
<span class="keyword">import</span> org.springframework.ui.Model;
<span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;
<span class="keyword">import</span> org.springframework.web.bind.annotation.RequestParam;
<span class="keyword">import</span> org.springframework.web.util.HtmlUtils;

<span class="meta">@Controller</span>
<span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">InputController</span> {

    <span class="meta">@GetMapping("/input")</span>
    <span class="keyword">public</span> String <span class="title function_">handleInput</span><span class="params">(<span class="meta">@RequestParam("input")</span> String userInput, Model model)</span> {
        model.addAttribute(<span class="string">"userInput"</span>, HtmlUtils.htmlEscape(userInput));
        <span class="keyword">return</span> <span class="string">"input-template"</span>;
    }
}</code></pre>

<h4 id="示例3"><a href="#示例3" class="headerlink" title="示例3"></a>示例3</h4><p>vul</p>
<pre><code class="highlight java"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;
<span class="keyword">import</span> org.springframework.web.bind.annotation.RequestParam;
<span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;

<span class="meta">@RestController</span>
<span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">InputController</span> {

    <span class="meta">@GetMapping("/input")</span>
    <span class="keyword">public</span> String <span class="title function_">handleInput</span><span class="params">(<span class="meta">@RequestParam("input")</span> String userInput)</span> {
        <span class="type">String</span> <span class="variable">script</span> <span class="operator">=</span> <span class="string">"&lt;script&gt;alert('"</span> + userInput + <span class="string">"');&lt;/script&gt;"</span>;
        <span class="keyword">return</span> script;
    }
}</code></pre>

<p>fix</p>
<pre><code class="highlight java"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;
<span class="keyword">import</span> org.springframework.web.bind.annotation.RequestParam;
<span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;
<span class="keyword">import</span> org.springframework.web.util.HtmlUtils;

<span class="meta">@RestController</span>
<span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">InputController</span> {

    <span class="meta">@GetMapping("/input")</span>
    <span class="keyword">public</span> String <span class="title function_">handleInput</span><span class="params">(<span class="meta">@RequestParam("input")</span> String userInput)</span> {
        <span class="type">String</span> <span class="variable">script</span> <span class="operator">=</span> String.format(<span class="string">"&lt;script&gt;alert('%s');&lt;/script&gt;"</span>, HtmlUtils.htmlEscape(userInput));
        <span class="keyword">return</span> script;
    }
}</code></pre>

<h3 id="nodejs-2"><a href="#nodejs-2" class="headerlink" title="nodejs"></a>nodejs</h3><h4 id="示例1-1"><a href="#示例1-1" class="headerlink" title="示例1"></a>示例1</h4><p>vul</p>
<pre><code class="highlight javascript"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>);
<span class="keyword">const</span> app = <span class="title function_">express</span>();

app.<span class="title function_">get</span>(<span class="string">'/input'</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> {
  <span class="keyword">const</span> userInput = req.<span class="property">query</span>.<span class="property">input</span>;
  res.<span class="title function_">send</span>(userInput);
});

app.<span class="title function_">listen</span>(<span class="number">3000</span>, <span class="function">() =&gt;</span> {
  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">'Server is running on port 3000'</span>);
});</code></pre>

<p>fix</p>
<pre><code class="highlight javascript"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>);
<span class="keyword">const</span> app = <span class="title function_">express</span>();
<span class="keyword">const</span> { <span class="built_in">escape</span> } = <span class="built_in">require</span>(<span class="string">'html-escaper'</span>);

app.<span class="title function_">get</span>(<span class="string">'/input'</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> {
  <span class="keyword">const</span> userInput = req.<span class="property">query</span>.<span class="property">input</span>;
  <span class="keyword">const</span> escapedInput = <span class="built_in">escape</span>(userInput);
  res.<span class="title function_">send</span>(escapedInput);
});

app.<span class="title function_">listen</span>(<span class="number">3000</span>, <span class="function">() =&gt;</span> {
  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">'Server is running on port 3000'</span>);
});</code></pre>

<h4 id="示例2-1"><a href="#示例2-1" class="headerlink" title="示例2"></a>示例2</h4><p>vul</p>
<pre><code class="highlight javascript"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>);
<span class="keyword">const</span> app = <span class="title function_">express</span>();

app.<span class="title function_">set</span>(<span class="string">'view engine'</span>, <span class="string">'ejs'</span>);

app.<span class="title function_">get</span>(<span class="string">'/input'</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> {
  <span class="keyword">const</span> userInput = req.<span class="property">query</span>.<span class="property">input</span>;
  res.<span class="title function_">render</span>(<span class="string">'input-template'</span>, { userInput });
});

app.<span class="title function_">listen</span>(<span class="number">3000</span>, <span class="function">() =&gt;</span> {
  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">'Server is running on port 3000'</span>);
});</code></pre>

<p>fix</p>
<pre><code class="highlight javascript"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>);
<span class="keyword">const</span> app = <span class="title function_">express</span>();
<span class="keyword">const</span> { <span class="built_in">escape</span> } = <span class="built_in">require</span>(<span class="string">'html-escaper'</span>);

app.<span class="title function_">set</span>(<span class="string">'view engine'</span>, <span class="string">'ejs'</span>);

app.<span class="title function_">get</span>(<span class="string">'/input'</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> {
  <span class="keyword">const</span> userInput = req.<span class="property">query</span>.<span class="property">input</span>;
  <span class="keyword">const</span> escapedInput = <span class="built_in">escape</span>(userInput);
  res.<span class="title function_">render</span>(<span class="string">'input-template'</span>, { <span class="attr">userInput</span>: escapedInput });
});

app.<span class="title function_">listen</span>(<span class="number">3000</span>, <span class="function">() =&gt;</span> {
  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">'Server is running on port 3000'</span>);
});</code></pre>

<h4 id="示例3-1"><a href="#示例3-1" class="headerlink" title="示例3"></a>示例3</h4><p>vul</p>
<pre><code class="highlight javascript"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>);
<span class="keyword">const</span> app = <span class="title function_">express</span>();

app.<span class="title function_">get</span>(<span class="string">'/input'</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> {
  <span class="keyword">const</span> userInput = req.<span class="property">query</span>.<span class="property">input</span>;
  <span class="keyword">const</span> script = <span class="string">`&lt;script&gt;alert('<span class="subst">${userInput}</span>');&lt;/script&gt;`</span>;
  res.<span class="title function_">send</span>(script);
});

app.<span class="title function_">listen</span>(<span class="number">3000</span>, <span class="function">() =&gt;</span> {
  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">'Server is running on port 3000'</span>);
});</code></pre>

<p>fix</p>
<pre><code class="highlight javascript"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>);
<span class="keyword">const</span> app = <span class="title function_">express</span>();
<span class="keyword">const</span> { <span class="built_in">escape</span> } = <span class="built_in">require</span>(<span class="string">'html-escaper'</span>);

app.<span class="title function_">get</span>(<span class="string">'/input'</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> {
  <span class="keyword">const</span> userInput = req.<span class="property">query</span>.<span class="property">input</span>;
  <span class="keyword">const</span> escapedInput = <span class="built_in">escape</span>(userInput);
  <span class="keyword">const</span> script = <span class="string">`&lt;script&gt;alert('<span class="subst">${escapedInput}</span>');&lt;/script&gt;`</span>;
  res.<span class="title function_">send</span>(script);
});

app.<span class="title function_">listen</span>(<span class="number">3000</span>, <span class="function">() =&gt;</span> {
  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">'Server is running on port 3000'</span>);
});</code></pre>

<h3 id="python-2"><a href="#python-2" class="headerlink" title="python"></a>python</h3><h4 id="示例1-2"><a href="#示例1-2" class="headerlink" title="示例1"></a>示例1</h4><p>vul</p>
<pre><code class="highlight python"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request

app = Flask(__name__)

<span class="meta">@app.route(<span class="params"><span class="string">'/input'</span></span>)</span>
<span class="keyword">def</span> <span class="title function_">handle_input</span>():
    userInput = request.args.get(<span class="string">'input'</span>)
    <span class="keyword">return</span> userInput

<span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:
    app.run()</code></pre>

<p>fix</p>
<pre><code class="highlight python"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request
<span class="keyword">from</span> markupsafe <span class="keyword">import</span> escape

app = Flask(__name__)

<span class="meta">@app.route(<span class="params"><span class="string">'/input'</span></span>)</span>
<span class="keyword">def</span> <span class="title function_">handle_input</span>():
    userInput = request.args.get(<span class="string">'input'</span>)
    <span class="keyword">return</span> escape(userInput)

<span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:
    app.run()</code></pre>

<h4 id="示例2-2"><a href="#示例2-2" class="headerlink" title="示例2"></a>示例2</h4><p>vul</p>
<pre><code class="highlight python"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, render_template_string, request

app = Flask(__name__)

<span class="meta">@app.route(<span class="params"><span class="string">'/input'</span></span>)</span>
<span class="keyword">def</span> <span class="title function_">handle_input</span>():
    userInput = request.args.get(<span class="string">'input'</span>)
    <span class="keyword">return</span> render_template_string(<span class="string">'&lt;h1&gt;{{ userInput }}&lt;/h1&gt;'</span>, userInput=userInput)

<span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:
    app.run()</code></pre>

<p>fix</p>
<pre><code class="highlight python"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, render_template_string, request

app = Flask(__name__)

<span class="meta">@app.route(<span class="params"><span class="string">'/input'</span></span>)</span>
<span class="keyword">def</span> <span class="title function_">handle_input</span>():
    userInput = request.args.get(<span class="string">'input'</span>)
    <span class="keyword">return</span> render_template_string(<span class="string">'&lt;h1&gt;{{ userInput|safe }}&lt;/h1&gt;'</span>, userInput=userInput)

<span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:
    app.run()</code></pre>

<h4 id="示例3-2"><a href="#示例3-2" class="headerlink" title="示例3"></a>示例3</h4><p>vul</p>
<pre><code class="highlight python"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request

app = Flask(__name__)

<span class="meta">@app.route(<span class="params"><span class="string">'/input'</span></span>)</span>
<span class="keyword">def</span> <span class="title function_">handle_input</span>():
    userInput = request.args.get(<span class="string">'input'</span>)
    script = <span class="string">'&lt;script&gt;alert("'</span> + userInput + <span class="string">'");&lt;/script&gt;'</span>
    <span class="keyword">return</span> script

<span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:
    app.run()</code></pre>

<p>fix</p>
<pre><code class="highlight python"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request

app = Flask(__name__)

<span class="meta">@app.route(<span class="params"><span class="string">'/input'</span></span>)</span>
<span class="keyword">def</span> <span class="title function_">handle_input</span>():
    userInput = request.args.get(<span class="string">'input'</span>)
    script = <span class="string">'&lt;script&gt;alert("{0}");&lt;/script&gt;'</span>.<span class="built_in">format</span>(userInput)
    <span class="keyword">return</span> script

<span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:
    app.run()</code></pre>



<h2 id="SSRF"><a href="#SSRF" class="headerlink" title="SSRF"></a>SSRF</h2><h3 id="php-3"><a href="#php-3" class="headerlink" title="php"></a>php</h3><h4 id="示例1-3"><a href="#示例1-3" class="headerlink" title="示例1"></a>示例1</h4><p>vul</p>
<pre><code class="highlight php"><span class="meta">&lt;?php</span>
<span class="variable">$url</span> = <span class="variable">$_GET</span>[<span class="string">'url'</span>];
<span class="variable">$data</span> = <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$url</span>);
<span class="keyword">echo</span> <span class="variable">$data</span>;
<span class="meta">?&gt;</span></code></pre>

<p>fix</p>
<pre><code class="highlight php"><span class="meta">&lt;?php</span>
<span class="variable">$allowedDomains</span> = [<span class="string">'example.com'</span>, <span class="string">'example.org'</span>];
<span class="variable">$url</span> = <span class="variable">$_GET</span>[<span class="string">'url'</span>];
<span class="variable">$parsedUrl</span> = <span class="title function_ invoke__">parse_url</span>(<span class="variable">$url</span>);

<span class="keyword">if</span> (<span class="variable">$parsedUrl</span> &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$parsedUrl</span>[<span class="string">'host'</span>]) &amp;&amp; <span class="title function_ invoke__">in_array</span>(<span class="variable">$parsedUrl</span>[<span class="string">'host'</span>], <span class="variable">$allowedDomains</span>)) {
    <span class="variable">$data</span> = <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$url</span>);
    <span class="keyword">echo</span> <span class="variable">$data</span>;
} <span class="keyword">else</span> {
    <span class="keyword">echo</span> <span class="string">'Invalid URL'</span>;
}
<span class="meta">?&gt;</span></code></pre>

<h4 id="示例2-3"><a href="#示例2-3" class="headerlink" title="示例2"></a>示例2</h4><p>vul</p>
<pre><code class="highlight php"><span class="meta">&lt;?php</span>
<span class="variable">$url</span> = <span class="variable">$_GET</span>[<span class="string">'url'</span>];
<span class="variable">$image</span> = <span class="title function_ invoke__">imagecreatefromjpeg</span>(<span class="variable">$url</span>);
<span class="title function_ invoke__">header</span>(<span class="string">'Content-Type: image/jpeg'</span>);
<span class="title function_ invoke__">imagejpeg</span>(<span class="variable">$image</span>);
<span class="title function_ invoke__">imagedestroy</span>(<span class="variable">$image</span>);
<span class="meta">?&gt;</span></code></pre>

<p>fix</p>
<pre><code class="highlight php"><span class="meta">&lt;?php</span>
<span class="variable">$allowedPaths</span> = [<span class="string">'/path/to/images/'</span>];
<span class="variable">$url</span> = <span class="variable">$_GET</span>[<span class="string">'url'</span>];
<span class="variable">$filePath</span> = <span class="title function_ invoke__">realpath</span>(<span class="variable">$url</span>);

<span class="keyword">if</span> (<span class="variable">$filePath</span> &amp;&amp; <span class="title function_ invoke__">is_file</span>(<span class="variable">$filePath</span>) &amp;&amp; <span class="title function_ invoke__">in_array</span>(<span class="title function_ invoke__">dirname</span>(<span class="variable">$filePath</span>), <span class="variable">$allowedPaths</span>)) {
    <span class="variable">$image</span> = <span class="title function_ invoke__">imagecreatefromjpeg</span>(<span class="variable">$filePath</span>);
    <span class="title function_ invoke__">header</span>(<span class="string">'Content-Type: image/jpeg'</span>);
    <span class="title function_ invoke__">imagejpeg</span>(<span class="variable">$image</span>);
    <span class="title function_ invoke__">imagedestroy</span>(<span class="variable">$image</span>);
} <span class="keyword">else</span> {
    <span class="keyword">echo</span> <span class="string">'Invalid URL'</span>;
}
<span class="meta">?&gt;</span></code></pre>

<h3 id="java-3"><a href="#java-3" class="headerlink" title="java"></a>java</h3><h4 id="示例1-4"><a href="#示例1-4" class="headerlink" title="示例1"></a>示例1</h4><p>vul</p>
<pre><code class="highlight java"><span class="keyword">import</span> java.io.BufferedReader;
<span class="keyword">import</span> java.io.IOException;
<span class="keyword">import</span> java.io.InputStreamReader;
<span class="keyword">import</span> java.net.URL;

<span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SSRFExample</span> {
    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException {
        <span class="type">String</span> <span class="variable">url</span> <span class="operator">=</span> args[<span class="number">0</span>];
        <span class="type">BufferedReader</span> <span class="variable">reader</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BufferedReader</span>(<span class="keyword">new</span> <span class="title class_">InputStreamReader</span>(<span class="keyword">new</span> <span class="title class_">URL</span>(url).openStream()));
        String line;
        <span class="keyword">while</span> ((line = reader.readLine()) != <span class="literal">null</span>) {
            System.out.println(line);
        }
        reader.close();
    }
}</code></pre>

<p>fix</p>
<pre><code class="highlight java"><span class="keyword">import</span> java.io.BufferedReader;
<span class="keyword">import</span> java.io.IOException;
<span class="keyword">import</span> java.io.InputStreamReader;
<span class="keyword">import</span> java.net.URL;

<span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SSRFExample</span> {
    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String[] ALLOWED_DOMAINS = { <span class="string">"example.com"</span>, <span class="string">"example.org"</span> };

    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException {
        <span class="type">String</span> <span class="variable">url</span> <span class="operator">=</span> args[<span class="number">0</span>];
        <span class="type">URL</span> <span class="variable">validatedUrl</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">URL</span>(url);
        <span class="type">String</span> <span class="variable">domain</span> <span class="operator">=</span> validatedUrl.getHost();
        
        <span class="keyword">if</span> (isValidDomain(domain)) {
            <span class="type">BufferedReader</span> <span class="variable">reader</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BufferedReader</span>(<span class="keyword">new</span> <span class="title class_">InputStreamReader</span>(validatedUrl.openStream()));
            String line;
            <span class="keyword">while</span> ((line = reader.readLine()) != <span class="literal">null</span>) {
                System.out.println(line);
            }
            reader.close();
        } <span class="keyword">else</span> {
            System.out.println(<span class="string">"Invalid URL"</span>);
        }
    }

    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">boolean</span> <span class="title function_">isValidDomain</span><span class="params">(String domain)</span> {
        <span class="keyword">for</span> (String allowedDomain : ALLOWED_DOMAINS) {
            <span class="keyword">if</span> (allowedDomain.equals(domain)) {
                <span class="keyword">return</span> <span class="literal">true</span>;
            }
        }
        <span class="keyword">return</span> <span class="literal">false</span>;
    }
}</code></pre>

<h4 id="示例2-4"><a href="#示例2-4" class="headerlink" title="示例2"></a>示例2</h4><p>vul</p>
<pre><code class="highlight java"><span class="keyword">import</span> java.awt.image.BufferedImage;
<span class="keyword">import</span> java.io.IOException;
<span class="keyword">import</span> java.net.URL;
<span class="keyword">import</span> javax.imageio.ImageIO;

<span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SSRFExample</span> {
    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException {
        <span class="type">String</span> <span class="variable">url</span> <span class="operator">=</span> args[<span class="number">0</span>];
        <span class="type">BufferedImage</span> <span class="variable">image</span> <span class="operator">=</span> ImageIO.read(<span class="keyword">new</span> <span class="title class_">URL</span>(url));
        <span class="comment">// 处理图像...</span>
    }
}</code></pre>

<p>fix</p>
<pre><code class="highlight java"><span class="keyword">import</span> java.awt.image.BufferedImage;
<span class="keyword">import</span> java.io.File;
<span class="keyword">import</span> java.io.IOException;
<span class="keyword">import</span> java.net.URL;
<span class="keyword">import</span> javax.imageio.ImageIO;

<span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SSRFExample</span> {
    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String[] ALLOWED_PATHS = { <span class="string">"/path/to/images/"</span> };

    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException {
        <span class="type">String</span> <span class="variable">url</span> <span class="operator">=</span> args[<span class="number">0</span>];
        <span class="type">URL</span> <span class="variable">validatedUrl</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">URL</span>(url);
        <span class="type">String</span> <span class="variable">filePath</span> <span class="operator">=</span> validatedUrl.getPath();
        
        <span class="keyword">if</span> (isValidPath(filePath)) {
            <span class="type">File</span> <span class="variable">file</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(filePath);
            <span class="type">BufferedImage</span> <span class="variable">image</span> <span class="operator">=</span> ImageIO.read(file);
            <span class="comment">// 处理图像...</span>
        } <span class="keyword">else</span> {
            System.out.println(<span class="string">"Invalid URL"</span>);
        }
    }

    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">boolean</span> <span class="title function_">isValidPath</span><span class="params">(String path)</span> {
        <span class="keyword">for</span> (String allowedPath : ALLOWED_PATHS) {
            <span class="keyword">if</span> (path.startsWith(allowedPath)) {
                <span class="keyword">return</span> <span class="literal">true</span>;
            }
        }
        <span class="keyword">return</span> <span class="literal">false</span>;
    }
}</code></pre>

<h3 id="python-3"><a href="#python-3" class="headerlink" title="python"></a>python</h3><h4 id="示例1-5"><a href="#示例1-5" class="headerlink" title="示例1"></a>示例1</h4><p>vul</p>
<pre><code class="highlight python"><span class="keyword">import</span> requests

url = <span class="built_in">input</span>(<span class="string">"Enter the URL: "</span>)
response = requests.get(url)
<span class="built_in">print</span>(response.text)</code></pre>

<p>fix</p>
<pre><code class="highlight python"><span class="keyword">import</span> requests

allowed_domains = [<span class="string">'example.com'</span>, <span class="string">'example.org'</span>]
url = <span class="built_in">input</span>(<span class="string">"Enter the URL: "</span>)

<span class="keyword">if</span> <span class="built_in">any</span>(domain <span class="keyword">in</span> url <span class="keyword">for</span> domain <span class="keyword">in</span> allowed_domains):
    response = requests.get(url)
    <span class="built_in">print</span>(response.text)
<span class="keyword">else</span>:
    <span class="built_in">print</span>(<span class="string">"Invalid URL"</span>)</code></pre>

<h4 id="示例2-5"><a href="#示例2-5" class="headerlink" title="示例2"></a>示例2</h4><p>vul</p>
<pre><code class="highlight python"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image

url = <span class="built_in">input</span>(<span class="string">"Enter the URL: "</span>)
image = Image.<span class="built_in">open</span>(url)
<span class="comment"># 处理图像...</span></code></pre>

<p>fix</p>
<pre><code class="highlight python"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image

allowed_paths = [<span class="string">'/path/to/images/'</span>]
url = <span class="built_in">input</span>(<span class="string">"Enter the URL: "</span>)

<span class="keyword">if</span> <span class="built_in">any</span>(url.startswith(path) <span class="keyword">for</span> path <span class="keyword">in</span> allowed_paths):
    image = Image.<span class="built_in">open</span>(url)
    <span class="comment"># 处理图像...</span>
<span class="keyword">else</span>:
    <span class="built_in">print</span>(<span class="string">"Invalid URL"</span>)</code></pre>

<h3 id="nodejs-3"><a href="#nodejs-3" class="headerlink" title="nodejs"></a>nodejs</h3><h4 id="示例1-6"><a href="#示例1-6" class="headerlink" title="示例1"></a>示例1</h4><p>vul</p>
<pre><code class="highlight javascript"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>);

<span class="keyword">const</span> server = http.<span class="title function_">createServer</span>(<span class="function">(<span class="params">req, res</span>) =&gt;</span> {
  <span class="keyword">const</span> url = req.<span class="property">url</span>.<span class="title function_">slice</span>(<span class="number">1</span>);
  http.<span class="title function_">get</span>(url, <span class="function">(<span class="params">response</span>) =&gt;</span> {
    <span class="keyword">let</span> data = <span class="string">''</span>;
    response.<span class="title function_">on</span>(<span class="string">'data'</span>, <span class="function">(<span class="params">chunk</span>) =&gt;</span> {
      data += chunk;
    });
    response.<span class="title function_">on</span>(<span class="string">'end'</span>, <span class="function">() =&gt;</span> {
      res.<span class="title function_">end</span>(data);
    });
  });
});

server.<span class="title function_">listen</span>(<span class="number">3000</span>, <span class="function">() =&gt;</span> {
  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">'Server is running on port 3000'</span>);
});</code></pre>

<p>fix</p>
<pre><code class="highlight javascript"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>);

<span class="keyword">const</span> allowedDomains = [<span class="string">'example.com'</span>, <span class="string">'example.org'</span>];

<span class="keyword">const</span> server = http.<span class="title function_">createServer</span>(<span class="function">(<span class="params">req, res</span>) =&gt;</span> {
  <span class="keyword">const</span> url = req.<span class="property">url</span>.<span class="title function_">slice</span>(<span class="number">1</span>);
  <span class="keyword">const</span> parsedUrl = <span class="keyword">new</span> <span class="title function_">URL</span>(url);
  <span class="keyword">const</span> domain = parsedUrl.<span class="property">hostname</span>;

  <span class="keyword">if</span> (allowedDomains.<span class="title function_">includes</span>(domain)) {
    http.<span class="title function_">get</span>(url, <span class="function">(<span class="params">response</span>) =&gt;</span> {
      <span class="keyword">let</span> data = <span class="string">''</span>;
      response.<span class="title function_">on</span>(<span class="string">'data'</span>, <span class="function">(<span class="params">chunk</span>) =&gt;</span> {
        data += chunk;
      });
      response.<span class="title function_">on</span>(<span class="string">'end'</span>, <span class="function">() =&gt;</span> {
        res.<span class="title function_">end</span>(data);
      });
    });
  } <span class="keyword">else</span> {
    res.<span class="title function_">end</span>(<span class="string">'Invalid URL'</span>);
  }
});

server.<span class="title function_">listen</span>(<span class="number">3000</span>, <span class="function">() =&gt;</span> {
  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">'Server is running on port 3000'</span>);
});</code></pre>

<h4 id="示例2-6"><a href="#示例2-6" class="headerlink" title="示例2"></a>示例2</h4><p>vul</p>
<pre><code class="highlight javascript"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>);
<span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);

<span class="keyword">const</span> server = http.<span class="title function_">createServer</span>(<span class="function">(<span class="params">req, res</span>) =&gt;</span> {
  <span class="keyword">const</span> url = req.<span class="property">url</span>.<span class="title function_">slice</span>(<span class="number">1</span>);
  <span class="keyword">const</span> fileStream = fs.<span class="title function_">createReadStream</span>(url);
  fileStream.<span class="title function_">pipe</span>(res);
});

server.<span class="title function_">listen</span>(<span class="number">3000</span>, <span class="function">() =&gt;</span> {
  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">'Server is running on port 3000'</span>);
});</code></pre>

<p>fix</p>
<pre><code class="highlight javascript"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>);
<span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);
<span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>);

<span class="keyword">const</span> allowedPaths = [<span class="string">'/path/to/files'</span>];

<span class="keyword">const</span> server = http.<span class="title function_">createServer</span>(<span class="function">(<span class="params">req, res</span>) =&gt;</span> {
  <span class="keyword">const</span> url = req.<span class="property">url</span>.<span class="title function_">slice</span>(<span class="number">1</span>);
  <span class="keyword">const</span> filePath = path.<span class="title function_">join</span>(__dirname, url);

  <span class="keyword">if</span> (allowedPaths.<span class="title function_">some</span>(<span class="function"><span class="params">allowedPath</span> =&gt;</span> filePath.<span class="title function_">startsWith</span>(allowedPath))) {
    <span class="keyword">const</span> fileStream = fs.<span class="title function_">createReadStream</span>(filePath);
    fileStream.<span class="title function_">pipe</span>(res);
  } <span class="keyword">else</span> {
    res.<span class="title function_">end</span>(<span class="string">'Invalid URL'</span>);
  }
});

server.<span class="title function_">listen</span>(<span class="number">3000</span>, <span class="function">() =&gt;</span> {
  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">'Server is running on port 3000'</span>);
});</code></pre>

<h2 id="命令注入"><a href="#命令注入" class="headerlink" title="命令注入"></a>命令注入</h2><h3 id="php-4"><a href="#php-4" class="headerlink" title="php"></a>php</h3><h4 id="示例1-7"><a href="#示例1-7" class="headerlink" title="示例1"></a>示例1</h4><p>vul</p>
<pre><code class="highlight php"><span class="meta">&lt;?php</span>
    <span class="variable">$userInput</span> = <span class="variable">$_GET</span>[<span class="string">'input'</span>];
    <span class="variable">$output</span> = <span class="title function_ invoke__">shell_exec</span>(<span class="string">'ls '</span> . <span class="variable">$userInput</span>);
    <span class="keyword">echo</span> <span class="variable">$output</span>;
<span class="meta">?&gt;</span></code></pre>

<p>fix</p>
<pre><code class="highlight php"><span class="meta">&lt;?php</span>
    <span class="variable">$userInput</span> = <span class="variable">$_GET</span>[<span class="string">'input'</span>];

    <span class="comment">// 使用参数化查询</span>
    <span class="variable">$output</span> = <span class="title function_ invoke__">shell_exec</span>(<span class="string">'ls ?'</span> , <span class="title function_ invoke__">escapeshellarg</span>(<span class="variable">$userInput</span>));
    <span class="keyword">echo</span> <span class="variable">$output</span>;

    <span class="comment">// 或者使用命令行参数的转义</span>
    <span class="comment">// $output = shell_exec('ls ' . escapeshellcmd($userInput));</span>
    <span class="comment">// echo $output;</span>
<span class="meta">?&gt;</span></code></pre>

<h4 id="示例2-7"><a href="#示例2-7" class="headerlink" title="示例2"></a>示例2</h4><p>vul</p>
<pre><code class="highlight php"><span class="meta">&lt;?php</span>
    <span class="variable">$userInput</span> = <span class="variable">$_GET</span>[<span class="string">'input'</span>];
    <span class="variable">$output</span> = <span class="title function_ invoke__">system</span>(<span class="string">'ls '</span> . <span class="variable">$userInput</span>);
    <span class="keyword">echo</span> <span class="variable">$output</span>;
<span class="meta">?&gt;</span></code></pre>

<p>fix</p>
<pre><code class="highlight php"><span class="meta">&lt;?php</span>
    <span class="variable">$userInput</span> = <span class="variable">$_GET</span>[<span class="string">'input'</span>];
    <span class="variable">$output</span> = <span class="title function_ invoke__">system</span>(<span class="string">'ls '</span> . <span class="title function_ invoke__">escapeshellarg</span>(<span class="variable">$userInput</span>), <span class="variable">$returnValue</span>);
    <span class="keyword">echo</span> <span class="variable">$output</span>;
<span class="meta">?&gt;</span></code></pre>

<h4 id="示例3-3"><a href="#示例3-3" class="headerlink" title="示例3"></a>示例3</h4><p>vul</p>
<pre><code class="highlight php"><span class="meta">&lt;?php</span>
    <span class="variable">$userInput</span> = <span class="variable">$_GET</span>[<span class="string">'input'</span>];
    <span class="variable">$output</span> = `ls <span class="variable">$userInput</span>`;
    <span class="keyword">echo</span> <span class="variable">$output</span>;
<span class="meta">?&gt;</span></code></pre>

<p>fix</p>
<pre><code class="highlight php"><span class="meta">&lt;?php</span>
    <span class="variable">$userInput</span> = <span class="variable">$_GET</span>[<span class="string">'input'</span>];
    <span class="variable">$output</span> = `ls ` . <span class="title function_ invoke__">escapeshellarg</span>(<span class="variable">$userInput</span>);
    <span class="keyword">echo</span> <span class="variable">$output</span>;
<span class="meta">?&gt;</span></code></pre>

<h3 id="java-4"><a href="#java-4" class="headerlink" title="java"></a>java</h3><h4 id="示例1-8"><a href="#示例1-8" class="headerlink" title="示例1"></a>示例1</h4><p>vul</p>
<pre><code class="highlight java"><span class="keyword">import</span> java.io.BufferedReader;
<span class="keyword">import</span> java.io.IOException;
<span class="keyword">import</span> java.io.InputStreamReader;

<span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CommandInjection</span> {
    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException {
        <span class="type">String</span> <span class="variable">userInput</span> <span class="operator">=</span> args[<span class="number">0</span>];
        <span class="type">String</span> <span class="variable">command</span> <span class="operator">=</span> <span class="string">"ls "</span> + userInput;
        <span class="type">Process</span> <span class="variable">process</span> <span class="operator">=</span> Runtime.getRuntime().exec(command);
        <span class="type">BufferedReader</span> <span class="variable">reader</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BufferedReader</span>(<span class="keyword">new</span> <span class="title class_">InputStreamReader</span>(process.getInputStream()));
        String line;
        <span class="keyword">while</span> ((line = reader.readLine()) != <span class="literal">null</span>) {
            System.out.println(line);
        }
    }
}</code></pre>

<p>fix</p>
<pre><code class="highlight java"><span class="keyword">import</span> java.io.BufferedReader;
<span class="keyword">import</span> java.io.IOException;
<span class="keyword">import</span> java.io.InputStreamReader;

<span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CommandInjection</span> {
    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException {
        <span class="type">String</span> <span class="variable">userInput</span> <span class="operator">=</span> args[<span class="number">0</span>];
        String[] command = { <span class="string">"ls"</span>, userInput };
        <span class="type">Process</span> <span class="variable">process</span> <span class="operator">=</span> Runtime.getRuntime().exec(command);
        <span class="type">BufferedReader</span> <span class="variable">reader</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BufferedReader</span>(<span class="keyword">new</span> <span class="title class_">InputStreamReader</span>(process.getInputStream()));
        String line;
        <span class="keyword">while</span> ((line = reader.readLine()) != <span class="literal">null</span>) {
            System.out.println(line);
        }
    }
}</code></pre>

<h4 id="示例2-8"><a href="#示例2-8" class="headerlink" title="示例2"></a>示例2</h4><p>fix</p>
<pre><code class="highlight java"><span class="keyword">import</span> java.io.BufferedReader;
<span class="keyword">import</span> java.io.IOException;
<span class="keyword">import</span> java.io.InputStreamReader;

<span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CommandInjection</span> {
    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException {
        <span class="type">String</span> <span class="variable">userInput</span> <span class="operator">=</span> args[<span class="number">0</span>];
        <span class="type">ProcessBuilder</span> <span class="variable">processBuilder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ProcessBuilder</span>(<span class="string">"ls"</span>, userInput);
        <span class="type">Process</span> <span class="variable">process</span> <span class="operator">=</span> processBuilder.start();
        <span class="type">BufferedReader</span> <span class="variable">reader</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BufferedReader</span>(<span class="keyword">new</span> <span class="title class_">InputStreamReader</span>(process.getInputStream()));
        String line;
        <span class="keyword">while</span> ((line = reader.readLine()) != <span class="literal">null</span>) {
            System.out.println(line);
        }
    }
}</code></pre>

<p>fix</p>
<pre><code class="highlight java"><span class="keyword">import</span> java.io.BufferedReader;
<span class="keyword">import</span> java.io.IOException;
<span class="keyword">import</span> java.io.InputStreamReader;

<span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CommandInjection</span> {
    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException {
        <span class="type">String</span> <span class="variable">userInput</span> <span class="operator">=</span> args[<span class="number">0</span>];
        <span class="type">ProcessBuilder</span> <span class="variable">processBuilder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ProcessBuilder</span>();
        processBuilder.command(<span class="string">"ls"</span>, userInput);
        <span class="type">Process</span> <span class="variable">process</span> <span class="operator">=</span> processBuilder.start();
        <span class="type">BufferedReader</span> <span class="variable">reader</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BufferedReader</span>(<span class="keyword">new</span> <span class="title class_">InputStreamReader</span>(process.getInputStream()));
        String line;
        <span class="keyword">while</span> ((line = reader.readLine()) != <span class="literal">null</span>) {
            System.out.println(line);
        }
    }
}</code></pre>

<h3 id="nodejs-4"><a href="#nodejs-4" class="headerlink" title="nodejs"></a>nodejs</h3><h4 id="示例1-9"><a href="#示例1-9" class="headerlink" title="示例1"></a>示例1</h4><p>vul</p>
<pre><code class="highlight javascript"><span class="keyword">const</span> exec = <span class="built_in">require</span>(<span class="string">'child_process'</span>).<span class="property">exec</span>;

app.<span class="title function_">get</span>(<span class="string">'/execute'</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> {
  <span class="keyword">const</span> userInput = req.<span class="property">query</span>.<span class="property">input</span>;
  <span class="keyword">const</span> command = <span class="string">`ls <span class="subst">${userInput}</span>`</span>;
  
  <span class="title function_">exec</span>(command, <span class="function">(<span class="params">error, stdout, stderr</span>) =&gt;</span> {
    <span class="keyword">if</span> (error) {
      <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">`Command execution error: <span class="subst">${error}</span>`</span>);
      res.<span class="title function_">status</span>(<span class="number">500</span>).<span class="title function_">send</span>(<span class="string">'Command execution failed'</span>);
    } <span class="keyword">else</span> {
      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`Command output: <span class="subst">${stdout}</span>`</span>);
      res.<span class="title function_">send</span>(stdout);
    }
  });
});
</code></pre>

<p>fix</p>
<pre><code class="highlight javascript"><span class="keyword">const</span> exec = <span class="built_in">require</span>(<span class="string">'child_process'</span>).<span class="property">exec</span>;

app.<span class="title function_">get</span>(<span class="string">'/execute'</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> {
  <span class="keyword">const</span> userInput = req.<span class="property">query</span>.<span class="property">input</span>;
  <span class="keyword">const</span> command = <span class="string">'ls'</span>;
  <span class="keyword">const</span> args = [userInput];
  
  <span class="title function_">execFile</span>(command, args, <span class="function">(<span class="params">error, stdout, stderr</span>) =&gt;</span> {
    <span class="keyword">if</span> (error) {
      <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">`Command execution error: <span class="subst">${error}</span>`</span>);
      res.<span class="title function_">status</span>(<span class="number">500</span>).<span class="title function_">send</span>(<span class="string">'Command execution failed'</span>);
    } <span class="keyword">else</span> {
      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`Command output: <span class="subst">${stdout}</span>`</span>);
      res.<span class="title function_">send</span>(stdout);
    }
  });
});</code></pre>

<h4 id="示例2-9"><a href="#示例2-9" class="headerlink" title="示例2"></a>示例2</h4><p>vul</p>
<pre><code class="highlight javascript"><span class="keyword">const</span> userInput = req.<span class="property">query</span>.<span class="property">input</span>;
<span class="keyword">const</span> output = <span class="built_in">require</span>(<span class="string">'child_process'</span>).<span class="title function_">execSync</span>(<span class="string">`ls <span class="subst">${userInput}</span>`</span>);
<span class="variable language_">console</span>.<span class="title function_">log</span>(output);</code></pre>

<p>fix</p>
<pre><code class="highlight javascript"><span class="keyword">const</span> userInput = req.<span class="property">query</span>.<span class="property">input</span>;
<span class="keyword">const</span> output = <span class="built_in">require</span>(<span class="string">'child_process'</span>).<span class="title function_">execSync</span>(<span class="string">'ls'</span>, [userInput]);
<span class="variable language_">console</span>.<span class="title function_">log</span>(output);</code></pre>

<h3 id="python-4"><a href="#python-4" class="headerlink" title="python"></a>python</h3><h4 id="示例1-10"><a href="#示例1-10" class="headerlink" title="示例1"></a>示例1</h4><p>vul</p>
<pre><code class="highlight python"><span class="keyword">import</span> subprocess

user_input = <span class="built_in">input</span>(<span class="string">"Enter a command: "</span>)
output = subprocess.check_output(<span class="string">'ls '</span> + user_input, shell=<span class="literal">True</span>)
<span class="built_in">print</span>(output)</code></pre>

<p>fix</p>
<pre><code class="highlight plaintext">import subprocess

user_input = input("Enter a command: ")
output = subprocess.check_output(['ls', user_input])
print(output)</code></pre>

<h4 id="示例2-10"><a href="#示例2-10" class="headerlink" title="示例2"></a>示例2</h4><p>vul</p>
<pre><code class="highlight python"><span class="keyword">import</span> os

user_input = <span class="built_in">input</span>(<span class="string">"Enter a command: "</span>)
os.system(<span class="string">'ls '</span> + user_input)</code></pre>

<p>fix</p>
<pre><code class="highlight python"><span class="keyword">import</span> subprocess

user_input = <span class="built_in">input</span>(<span class="string">"Enter a command: "</span>)
subprocess.call([<span class="string">'ls'</span>, user_input])</code></pre>

<h4 id="示例3-4"><a href="#示例3-4" class="headerlink" title="示例3"></a>示例3</h4><p>vul</p>
<pre><code class="highlight python"><span class="keyword">import</span> os

user_input = <span class="built_in">input</span>(<span class="string">"Enter a command: "</span>)
output = os.popen(<span class="string">'ls '</span> + user_input).read()
<span class="built_in">print</span>(output)</code></pre>

<p>fix</p>
<pre><code class="highlight python"><span class="keyword">import</span> subprocess

user_input = <span class="built_in">input</span>(<span class="string">"Enter a command: "</span>)
output = subprocess.getoutput([<span class="string">'ls'</span>, user_input])
<span class="built_in">print</span>(output)</code></pre>

<h2 id="目录穿越"><a href="#目录穿越" class="headerlink" title="目录穿越"></a>目录穿越</h2><h3 id="php-5"><a href="#php-5" class="headerlink" title="php"></a>php</h3><h4 id="示例1-11"><a href="#示例1-11" class="headerlink" title="示例1"></a>示例1</h4><p>vul</p>
<pre><code class="highlight php"><span class="meta">&lt;?php</span>
    <span class="variable">$file</span> = <span class="variable">$_GET</span>[<span class="string">'file'</span>];
    <span class="keyword">include</span>(<span class="variable">$file</span>);
<span class="meta">?&gt;</span></code></pre>

<p>fix</p>
<pre><code class="highlight plaintext">&lt;?php
    $file = $_GET['file'];
    $allowedDir = '/path/to/allowed/directory/';
    
    $filePath = realpath($allowedDir . $file);
    if ($filePath &amp;&amp; strpos($filePath, $allowedDir) === 0) {
        include($filePath);
    } else {
        echo 'Invalid file';
    }
?&gt;</code></pre>

<h4 id="示例2-11"><a href="#示例2-11" class="headerlink" title="示例2"></a>示例2</h4><p>vul</p>
<pre><code class="highlight php"><span class="meta">&lt;?php</span>
    <span class="variable">$file</span> = <span class="variable">$_GET</span>[<span class="string">'file'</span>];
    <span class="variable">$filePath</span> = <span class="string">'/path/to/files/'</span> . <span class="variable">$file</span>;
    
    <span class="title function_ invoke__">header</span>(<span class="string">'Content-Type: application/octet-stream'</span>);
    <span class="title function_ invoke__">header</span>(<span class="string">'Content-Disposition: attachment; filename='</span> . <span class="variable">$file</span>);
    <span class="title function_ invoke__">readfile</span>(<span class="variable">$filePath</span>);
<span class="meta">?&gt;</span></code></pre>

<p>fix</p>
<pre><code class="highlight php"><span class="meta">&lt;?php</span>
    <span class="variable">$file</span> = <span class="variable">$_GET</span>[<span class="string">'file'</span>];
    <span class="variable">$allowedDir</span> = <span class="string">'/path/to/allowed/directory/'</span>;
    
    <span class="variable">$filePath</span> = <span class="title function_ invoke__">realpath</span>(<span class="variable">$allowedDir</span> . <span class="variable">$file</span>);
    <span class="keyword">if</span> (<span class="variable">$filePath</span> &amp;&amp; <span class="title function_ invoke__">strpos</span>(<span class="variable">$filePath</span>, <span class="variable">$allowedDir</span>) === <span class="number">0</span>) {
        <span class="title function_ invoke__">header</span>(<span class="string">'Content-Type: application/octet-stream'</span>);
        <span class="title function_ invoke__">header</span>(<span class="string">'Content-Disposition: attachment; filename='</span> . <span class="variable">$file</span>);
        <span class="title function_ invoke__">readfile</span>(<span class="variable">$filePath</span>);
    } <span class="keyword">else</span> {
        <span class="keyword">echo</span> <span class="string">'Invalid file'</span>;
    }
<span class="meta">?&gt;</span></code></pre>

<h4 id="示例3-5"><a href="#示例3-5" class="headerlink" title="示例3"></a>示例3</h4><p>vul</p>
<pre><code class="highlight php"><span class="meta">&lt;?php</span>
    <span class="variable">$file</span> = <span class="variable">$_GET</span>[<span class="string">'file'</span>];
    <span class="variable">$filePath</span> = <span class="string">'/path/to/files/'</span> . <span class="variable">$file</span>;
    
    <span class="variable">$content</span> = <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$filePath</span>);
    <span class="keyword">echo</span> <span class="variable">$content</span>;
<span class="meta">?&gt;</span></code></pre>

<p>fix</p>
<pre><code class="highlight php"><span class="meta">&lt;?php</span>
    <span class="variable">$file</span> = <span class="variable">$_GET</span>[<span class="string">'file'</span>];
    <span class="variable">$allowedDir</span> = <span class="string">'/path/to/allowed/directory/'</span>;
    
    <span class="variable">$filePath</span> = <span class="title function_ invoke__">realpath</span>(<span class="variable">$allowedDir</span> . <span class="variable">$file</span>);
    <span class="keyword">if</span> (<span class="variable">$filePath</span> &amp;&amp; <span class="title function_ invoke__">strpos</span>(<span class="variable">$filePath</span>, <span class="variable">$allowedDir</span>) === <span class="number">0</span>) {
        <span class="variable">$content</span> = <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$filePath</span>);
        <span class="keyword">echo</span> <span class="variable">$content</span>;
    } <span class="keyword">else</span> {
        <span class="keyword">echo</span> <span class="string">'Invalid file'</span>;
    }
<span class="meta">?&gt;</span></code></pre>

<h3 id="java-5"><a href="#java-5" class="headerlink" title="java"></a>java</h3><h4 id="示例1-12"><a href="#示例1-12" class="headerlink" title="示例1"></a>示例1</h4><p>vul</p>
<pre><code class="highlight java"><span class="keyword">import</span> java.io.BufferedReader;
<span class="keyword">import</span> java.io.File;
<span class="keyword">import</span> java.io.FileReader;
<span class="keyword">import</span> java.io.IOException;

<span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FileReadExample</span> {
    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> {
        <span class="type">String</span> <span class="variable">fileName</span> <span class="operator">=</span> <span class="string">"../secretfile.txt"</span>;
        <span class="type">String</span> <span class="variable">filePath</span> <span class="operator">=</span> <span class="string">"/path/to/files/"</span> + fileName;
        
        <span class="keyword">try</span> (<span class="type">BufferedReader</span> <span class="variable">br</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BufferedReader</span>(<span class="keyword">new</span> <span class="title class_">FileReader</span>(filePath))) {
            String line;
            <span class="keyword">while</span> ((line = br.readLine()) != <span class="literal">null</span>) {
                System.out.println(line);
            }
        } <span class="keyword">catch</span> (IOException e) {
            e.printStackTrace();
        }
    }
}</code></pre>

<p>fix</p>
<pre><code class="highlight java"><span class="keyword">import</span> java.io.BufferedReader;
<span class="keyword">import</span> java.io.File;
<span class="keyword">import</span> java.io.FileReader;
<span class="keyword">import</span> java.io.IOException;

<span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FileReadExample</span> {
    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> {
        <span class="type">String</span> <span class="variable">fileName</span> <span class="operator">=</span> <span class="string">"../secretfile.txt"</span>;
        <span class="type">String</span> <span class="variable">allowedDir</span> <span class="operator">=</span> <span class="string">"/path/to/allowed/directory/"</span>;
        <span class="type">String</span> <span class="variable">filePath</span> <span class="operator">=</span> allowedDir + fileName;
        
        <span class="keyword">try</span> {
            <span class="type">File</span> <span class="variable">file</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(filePath);
            <span class="keyword">if</span> (file.getCanonicalPath().startsWith(allowedDir)) {
                <span class="keyword">try</span> (<span class="type">BufferedReader</span> <span class="variable">br</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BufferedReader</span>(<span class="keyword">new</span> <span class="title class_">FileReader</span>(file))) {
                    String line;
                    <span class="keyword">while</span> ((line = br.readLine()) != <span class="literal">null</span>) {
                        System.out.println(line);
                    }
                } <span class="keyword">catch</span> (IOException e) {
                    e.printStackTrace();
                }
            } <span class="keyword">else</span> {
                System.out.println(<span class="string">"Invalid file"</span>);
            }
        } <span class="keyword">catch</span> (IOException e) {
            e.printStackTrace();
        }
    }
}</code></pre>

<h4 id="示例2-12"><a href="#示例2-12" class="headerlink" title="示例2"></a>示例2</h4><p>vul</p>
<pre><code class="highlight java"><span class="keyword">import</span> java.io.File;
<span class="keyword">import</span> java.io.FileInputStream;
<span class="keyword">import</span> java.io.IOException;
<span class="keyword">import</span> java.io.OutputStream;
<span class="keyword">import</span> javax.servlet.http.HttpServlet;
<span class="keyword">import</span> javax.servlet.http.HttpServletRequest;
<span class="keyword">import</span> javax.servlet.http.HttpServletResponse;

<span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FileDownloadServlet</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> {
    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> IOException {
        <span class="type">String</span> <span class="variable">fileName</span> <span class="operator">=</span> request.getParameter(<span class="string">"file"</span>);
        <span class="type">String</span> <span class="variable">filePath</span> <span class="operator">=</span> <span class="string">"/path/to/files/"</span> + fileName;
        
        <span class="type">File</span> <span class="variable">file</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(filePath);
        <span class="keyword">if</span> (file.exists()) {
            response.setContentType(<span class="string">"application/octet-stream"</span>);
            response.setContentLength((<span class="type">int</span>) file.length());
            response.setHeader(<span class="string">"Content-Disposition"</span>, <span class="string">"attachment; filename="</span> + fileName);
            
            <span class="keyword">try</span> (<span class="type">FileInputStream</span> <span class="variable">fileInputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(file);
                 <span class="type">OutputStream</span> <span class="variable">outputStream</span> <span class="operator">=</span> response.getOutputStream()) {
                <span class="type">byte</span>[] buffer = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">4096</span>];
                <span class="type">int</span> bytesRead;
                <span class="keyword">while</span> ((bytesRead = fileInputStream.read(buffer)) != -<span class="number">1</span>) {
                    outputStream.write(buffer, <span class="number">0</span>, bytesRead);
                }
            }
        } <span class="keyword">else</span> {
            response.sendError(HttpServletResponse.SC_NOT_FOUND);
        }
    }
}</code></pre>

<p>fix</p>
<pre><code class="highlight java"><span class="keyword">import</span> java.io.File;
<span class="keyword">import</span> java.io.FileInputStream;
<span class="keyword">import</span> java.io.IOException;
<span class="keyword">import</span> java.io.OutputStream;
<span class="keyword">import</span> javax.servlet.http.HttpServlet;
<span class="keyword">import</span> javax.servlet.http.HttpServletRequest;
<span class="keyword">import</span> javax.servlet.http.HttpServletResponse;

<span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FileDownloadServlet</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> {
    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> IOException {
        <span class="type">String</span> <span class="variable">fileName</span> <span class="operator">=</span> request.getParameter(<span class="string">"file"</span>);
        <span class="type">String</span> <span class="variable">allowedDir</span> <span class="operator">=</span> <span class="string">"/path/to/allowed/directory/"</span>;
        <span class="type">String</span> <span class="variable">filePath</span> <span class="operator">=</span> allowedDir + fileName;
        
        <span class="type">File</span> <span class="variable">file</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(filePath);
        <span class="keyword">if</span> (file.exists() &amp;&amp; file.getCanonicalPath().startsWith(allowedDir)) {
            response.setContentType(<span class="string">"application/octet-stream"</span>);
            response.setContentLength((<span class="type">int</span>) file.length());
            response.setHeader(<span class="string">"Content-Disposition"</span>, <span class="string">"attachment; filename="</span> + fileName);
            
            <span class="keyword">try</span> (<span class="type">FileInputStream</span> <span class="variable">fileInputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(file);
                 <span class="type">OutputStream</span> <span class="variable">outputStream</span> <span class="operator">=</span> response.getOutputStream()) {
                <span class="type">byte</span>[] buffer = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">4096</span>];
                <span class="type">int</span> bytesRead;
                <span class="keyword">while</span> ((bytesRead = fileInputStream.read(buffer)) != -<span class="number">1</span>) {
                    outputStream.write(buffer, <span class="number">0</span>, bytesRead);
                }
            }
        } <span class="keyword">else</span> {
            response.sendError(HttpServletResponse.SC_NOT_FOUND);
        }
    }
}
</code></pre>

<h3 id="nodejs-5"><a href="#nodejs-5" class="headerlink" title="nodejs"></a>nodejs</h3><h4 id="示例1-13"><a href="#示例1-13" class="headerlink" title="示例1"></a>示例1</h4><p>vul</p>
<pre><code class="highlight javascript"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);

<span class="keyword">const</span> filePath = <span class="string">'/path/to/files/'</span> + req.<span class="property">query</span>.<span class="property">file</span>;

fs.<span class="title function_">readFile</span>(filePath, <span class="string">'utf8'</span>, <span class="function">(<span class="params">err, data</span>) =&gt;</span> {
  <span class="keyword">if</span> (err) {
    <span class="variable language_">console</span>.<span class="title function_">error</span>(err);
    <span class="keyword">return</span>;
  }
  <span class="variable language_">console</span>.<span class="title function_">log</span>(data);
});</code></pre>

<p>fix</p>
<pre><code class="highlight javascript"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);
<span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>);

<span class="keyword">const</span> allowedDir = <span class="string">'/path/to/allowed/directory/'</span>;

<span class="keyword">const</span> filePath = path.<span class="title function_">resolve</span>(allowedDir, req.<span class="property">query</span>.<span class="property">file</span>);

fs.<span class="title function_">realpath</span>(filePath, <span class="function">(<span class="params">err, resolvedPath</span>) =&gt;</span> {
  <span class="keyword">if</span> (err) {
    <span class="variable language_">console</span>.<span class="title function_">error</span>(err);
    <span class="keyword">return</span>;
  }
  <span class="keyword">if</span> (resolvedPath.<span class="title function_">startsWith</span>(allowedDir)) {
    fs.<span class="title function_">readFile</span>(resolvedPath, <span class="string">'utf8'</span>, <span class="function">(<span class="params">err, data</span>) =&gt;</span> {
      <span class="keyword">if</span> (err) {
        <span class="variable language_">console</span>.<span class="title function_">error</span>(err);
        <span class="keyword">return</span>;
      }
      <span class="variable language_">console</span>.<span class="title function_">log</span>(data);
    });
  } <span class="keyword">else</span> {
    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">'Invalid file'</span>);
  }
});</code></pre>

<h4 id="示例2-13"><a href="#示例2-13" class="headerlink" title="示例2"></a>示例2</h4><p>vul</p>
<pre><code class="highlight javascript"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);
<span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>);

<span class="keyword">const</span> filePath = <span class="string">'/path/to/files/'</span> + req.<span class="property">query</span>.<span class="property">file</span>;

<span class="keyword">const</span> fileStream = fs.<span class="title function_">createReadStream</span>(filePath);
fileStream.<span class="title function_">pipe</span>(res);</code></pre>

<p>fix</p>
<pre><code class="highlight javascript"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);
<span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>);

<span class="keyword">const</span> allowedDir = <span class="string">'/path/to/allowed/directory/'</span>;

<span class="keyword">const</span> filePath = path.<span class="title function_">resolve</span>(allowedDir, req.<span class="property">query</span>.<span class="property">file</span>);

fs.<span class="title function_">realpath</span>(filePath, <span class="function">(<span class="params">err, resolvedPath</span>) =&gt;</span> {
  <span class="keyword">if</span> (err) {
    <span class="variable language_">console</span>.<span class="title function_">error</span>(err);
    <span class="keyword">return</span>;
  }
  <span class="keyword">if</span> (resolvedPath.<span class="title function_">startsWith</span>(allowedDir)) {
    <span class="keyword">const</span> fileStream = fs.<span class="title function_">createReadStream</span>(resolvedPath);
    fileStream.<span class="title function_">pipe</span>(res);
  } <span class="keyword">else</span> {
    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">'Invalid file'</span>);
  }
});</code></pre>

<h3 id="python-5"><a href="#python-5" class="headerlink" title="python"></a>python</h3><h4 id="示例1-14"><a href="#示例1-14" class="headerlink" title="示例1"></a>示例1</h4><p>vul</p>
<pre><code class="highlight python">file_name = <span class="string">"../secretfile.txt"</span>
file_path = <span class="string">"/path/to/files/"</span> + file_name

<span class="keyword">with</span> <span class="built_in">open</span>(file_path, <span class="string">"r"</span>) <span class="keyword">as</span> file:
    data = file.read()
    <span class="built_in">print</span>(data)</code></pre>

<p>fix</p>
<pre><code class="highlight python"><span class="keyword">import</span> os

file_name = <span class="string">"../secretfile.txt"</span>
allowed_dir = <span class="string">"/path/to/allowed/directory/"</span>
file_path = os.path.join(allowed_dir, file_name)

<span class="keyword">if</span> os.path.realpath(file_path).startswith(allowed_dir):
    <span class="keyword">with</span> <span class="built_in">open</span>(file_path, <span class="string">"r"</span>) <span class="keyword">as</span> file:
        data = file.read()
        <span class="built_in">print</span>(data)
<span class="keyword">else</span>:
    <span class="built_in">print</span>(<span class="string">"Invalid file"</span>)</code></pre>

<h4 id="示例2-14"><a href="#示例2-14" class="headerlink" title="示例2"></a>示例2</h4><p>vul</p>
<pre><code class="highlight python"><span class="keyword">import</span> os
<span class="keyword">from</span> flask <span class="keyword">import</span> Flask, send_file

app = Flask(__name__)

<span class="meta">@app.route(<span class="params"><span class="string">"/download"</span></span>)</span>
<span class="keyword">def</span> <span class="title function_">download_file</span>():
    file_name = request.args.get(<span class="string">"file"</span>)
    file_path = <span class="string">"/path/to/files/"</span> + file_name
    <span class="keyword">return</span> send_file(file_path, as_attachment=<span class="literal">True</span>)

<span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:
    app.run()</code></pre>

<p>fix</p>
<pre><code class="highlight python"><span class="keyword">import</span> os
<span class="keyword">from</span> flask <span class="keyword">import</span> Flask, send_file

app = Flask(__name__)

<span class="meta">@app.route(<span class="params"><span class="string">"/download"</span></span>)</span>
<span class="keyword">def</span> <span class="title function_">download_file</span>():
    file_name = request.args.get(<span class="string">"file"</span>)
    allowed_dir = <span class="string">"/path/to/allowed/directory/"</span>
    file_path = os.path.join(allowed_dir, file_name)
    
    <span class="keyword">if</span> os.path.realpath(file_path).startswith(allowed_dir):
        <span class="keyword">return</span> send_file(file_path, as_attachment=<span class="literal">True</span>)
    <span class="keyword">else</span>:
        <span class="keyword">return</span> <span class="string">"Invalid file"</span>

<span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:
    app.run()</code></pre>

<h2 id="文件读取"><a href="#文件读取" class="headerlink" title="文件读取"></a>文件读取</h2><h3 id="php-6"><a href="#php-6" class="headerlink" title="php"></a>php</h3><h4 id="示例1-15"><a href="#示例1-15" class="headerlink" title="示例1"></a>示例1</h4><p>vul</p>
<pre><code class="highlight php"><span class="variable">$file</span> = <span class="variable">$_GET</span>[<span class="string">'file'</span>];
<span class="keyword">include</span>(<span class="variable">$file</span>);</code></pre>

<p>fix</p>
<pre><code class="highlight php"><span class="variable">$allowedDir</span> = <span class="string">'/path/to/allowed/directory/'</span>;
<span class="variable">$file</span> = <span class="variable">$_GET</span>[<span class="string">'file'</span>];
<span class="variable">$filePath</span> = <span class="variable">$allowedDir</span> . <span class="variable">$file</span>;

<span class="keyword">if</span> (<span class="title function_ invoke__">strpos</span>(<span class="title function_ invoke__">realpath</span>(<span class="variable">$filePath</span>), <span class="title function_ invoke__">realpath</span>(<span class="variable">$allowedDir</span>)) === <span class="number">0</span>) {
    <span class="keyword">include</span>(<span class="variable">$filePath</span>);
} <span class="keyword">else</span> {
    <span class="keyword">echo</span> <span class="string">'Invalid file'</span>;
}</code></pre>

<h4 id="示例2-15"><a href="#示例2-15" class="headerlink" title="示例2"></a>示例2</h4><p>vul</p>
<pre><code class="highlight php"><span class="variable">$file</span> = <span class="variable">$_GET</span>[<span class="string">'file'</span>];
<span class="variable">$fileContents</span> = <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$file</span>);
<span class="keyword">echo</span> <span class="variable">$fileContents</span>;</code></pre>

<p>fix</p>
<pre><code class="highlight php"><span class="variable">$allowedDir</span> = <span class="string">'/path/to/allowed/directory/'</span>;
<span class="variable">$file</span> = <span class="variable">$_GET</span>[<span class="string">'file'</span>];
<span class="variable">$filePath</span> = <span class="variable">$allowedDir</span> . <span class="variable">$file</span>;

<span class="keyword">if</span> (<span class="title function_ invoke__">strpos</span>(<span class="title function_ invoke__">realpath</span>(<span class="variable">$filePath</span>), <span class="title function_ invoke__">realpath</span>(<span class="variable">$allowedDir</span>)) === <span class="number">0</span>) {
    <span class="variable">$fileContents</span> = <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$filePath</span>);
    <span class="keyword">echo</span> <span class="variable">$fileContents</span>;
} <span class="keyword">else</span> {
    <span class="keyword">echo</span> <span class="string">'Invalid file'</span>;
}</code></pre>

<h4 id="示例3-6"><a href="#示例3-6" class="headerlink" title="示例3"></a>示例3</h4><p>vul</p>
<pre><code class="highlight php"><span class="variable">$file</span> = <span class="variable">$_GET</span>[<span class="string">'file'</span>];
<span class="variable">$fileLocation</span> = <span class="string">'/path/to/files/'</span> . <span class="variable">$file</span>;
<span class="title function_ invoke__">header</span>(<span class="string">'Content-Type: application/octet-stream'</span>);
<span class="title function_ invoke__">header</span>(<span class="string">'Content-Disposition: attachment; filename='</span> . <span class="variable">$file</span>);
<span class="title function_ invoke__">readfile</span>(<span class="variable">$fileLocation</span>);</code></pre>

<p>fix</p>
<pre><code class="highlight php"><span class="variable">$allowedDir</span> = <span class="string">'/path/to/allowed/directory/'</span>;
<span class="variable">$file</span> = <span class="variable">$_GET</span>[<span class="string">'file'</span>];
<span class="variable">$filePath</span> = <span class="variable">$allowedDir</span> . <span class="variable">$file</span>;

<span class="keyword">if</span> (<span class="title function_ invoke__">strpos</span>(<span class="title function_ invoke__">realpath</span>(<span class="variable">$filePath</span>), <span class="title function_ invoke__">realpath</span>(<span class="variable">$allowedDir</span>)) === <span class="number">0</span>) {
    <span class="title function_ invoke__">header</span>(<span class="string">'Content-Type: application/octet-stream'</span>);
    <span class="title function_ invoke__">header</span>(<span class="string">'Content-Disposition: attachment; filename='</span> . <span class="variable">$file</span>);
    <span class="title function_ invoke__">readfile</span>(<span class="variable">$filePath</span>);
} <span class="keyword">else</span> {
    <span class="keyword">echo</span> <span class="string">'Invalid file'</span>;
}</code></pre>

<h3 id="java-6"><a href="#java-6" class="headerlink" title="java"></a>java</h3><h4 id="示例1-16"><a href="#示例1-16" class="headerlink" title="示例1"></a>示例1</h4><p>vul</p>
<pre><code class="highlight java"><span class="type">String</span> <span class="variable">fileName</span> <span class="operator">=</span> request.getParameter(<span class="string">"file"</span>);
<span class="type">File</span> <span class="variable">file</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(fileName);
<span class="type">Scanner</span> <span class="variable">scanner</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Scanner</span>(file);

<span class="keyword">while</span> (scanner.hasNextLine()) {
    <span class="type">String</span> <span class="variable">line</span> <span class="operator">=</span> scanner.nextLine();
    System.out.println(line);
}

scanner.close();</code></pre>

<p>fix</p>
<pre><code class="highlight java"><span class="type">String</span> <span class="variable">allowedDir</span> <span class="operator">=</span> <span class="string">"/path/to/allowed/directory/"</span>;
<span class="type">String</span> <span class="variable">fileName</span> <span class="operator">=</span> request.getParameter(<span class="string">"file"</span>);
<span class="type">File</span> <span class="variable">file</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(allowedDir, fileName);

<span class="type">String</span> <span class="variable">canonicalPath</span> <span class="operator">=</span> file.getCanonicalPath();
<span class="type">String</span> <span class="variable">allowedPath</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(allowedDir).getCanonicalPath();

<span class="keyword">if</span> (canonicalPath.startsWith(allowedPath)) {
    <span class="type">Scanner</span> <span class="variable">scanner</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Scanner</span>(file);
    
    <span class="keyword">while</span> (scanner.hasNextLine()) {
        <span class="type">String</span> <span class="variable">line</span> <span class="operator">=</span> scanner.nextLine();
        System.out.println(line);
    }
    
    scanner.close();
} <span class="keyword">else</span> {
    System.out.println(<span class="string">"Invalid file"</span>);
}</code></pre>

<h4 id="示例2-16"><a href="#示例2-16" class="headerlink" title="示例2"></a>示例2</h4><p>vul</p>
<pre><code class="highlight java"><span class="type">String</span> <span class="variable">fileName</span> <span class="operator">=</span> request.getParameter(<span class="string">"file"</span>);
<span class="type">File</span> <span class="variable">file</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">"/path/to/files/"</span> + fileName);

response.setContentType(<span class="string">"application/octet-stream"</span>);
response.setHeader(<span class="string">"Content-Disposition"</span>, <span class="string">"attachment; filename="</span> + fileName);

<span class="keyword">try</span> (<span class="type">OutputStream</span> <span class="variable">out</span> <span class="operator">=</span> response.getOutputStream();
     <span class="type">FileInputStream</span> <span class="variable">in</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(file)) {

    <span class="type">byte</span>[] buffer = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">4096</span>];
    <span class="type">int</span> bytesRead;

    <span class="keyword">while</span> ((bytesRead = in.read(buffer)) != -<span class="number">1</span>) {
        out.write(buffer, <span class="number">0</span>, bytesRead);
    }
} <span class="keyword">catch</span> (IOException e) {
    e.printStackTrace();
}</code></pre>

<p>fix</p>
<pre><code class="highlight java"><span class="type">String</span> <span class="variable">allowedDir</span> <span class="operator">=</span> <span class="string">"/path/to/allowed/directory/"</span>;
<span class="type">String</span> <span class="variable">fileName</span> <span class="operator">=</span> request.getParameter(<span class="string">"file"</span>);
<span class="type">File</span> <span class="variable">file</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(allowedDir, fileName);

<span class="type">String</span> <span class="variable">canonicalPath</span> <span class="operator">=</span> file.getCanonicalPath();
<span class="type">String</span> <span class="variable">allowedPath</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(allowedDir).getCanonicalPath();

<span class="keyword">if</span> (canonicalPath.startsWith(allowedPath)) {
    response.setContentType(<span class="string">"application/octet-stream"</span>);
    response.setHeader(<span class="string">"Content-Disposition"</span>, <span class="string">"attachment; filename="</span> + fileName);

    <span class="keyword">try</span> (<span class="type">OutputStream</span> <span class="variable">out</span> <span class="operator">=</span> response.getOutputStream();
         <span class="type">FileInputStream</span> <span class="variable">in</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(file)) {

        <span class="type">byte</span>[] buffer = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">4096</span>];
        <span class="type">int</span> bytesRead;

        <span class="keyword">while</span> ((bytesRead = in.read(buffer)) != -<span class="number">1</span>) {
            out.write(buffer, <span class="number">0</span>, bytesRead);
        }
    } <span class="keyword">catch</span> (IOException e) {
        e.printStackTrace();
    }
} <span class="keyword">else</span> {
    System.out.println(<span class="string">"Invalid file"</span>);
}</code></pre>

<h3 id="nodejs-6"><a href="#nodejs-6" class="headerlink" title="nodejs"></a>nodejs</h3><h4 id="示例1-17"><a href="#示例1-17" class="headerlink" title="示例1"></a>示例1</h4><p>vul</p>
<pre><code class="highlight javascript"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);
<span class="keyword">const</span> fileName = req.<span class="property">query</span>.<span class="property">file</span>;
fs.<span class="title function_">readFile</span>(fileName, <span class="string">'utf8'</span>, <span class="function">(<span class="params">err, data</span>) =&gt;</span> {
  <span class="keyword">if</span> (err) {
    <span class="variable language_">console</span>.<span class="title function_">error</span>(err);
    <span class="keyword">return</span>;
  }
  <span class="variable language_">console</span>.<span class="title function_">log</span>(data);
});</code></pre>

<p>fix</p>
<pre><code class="highlight javascript"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);
<span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>);
<span class="keyword">const</span> allowedDir = <span class="string">'/path/to/allowed/directory/'</span>;
<span class="keyword">const</span> fileName = req.<span class="property">query</span>.<span class="property">file</span>;
<span class="keyword">const</span> filePath = path.<span class="title function_">join</span>(allowedDir, fileName);

<span class="keyword">if</span> (path.<span class="title function_">resolve</span>(filePath).<span class="title function_">startsWith</span>(path.<span class="title function_">resolve</span>(allowedDir))) {
  fs.<span class="title function_">readFile</span>(filePath, <span class="string">'utf8'</span>, <span class="function">(<span class="params">err, data</span>) =&gt;</span> {
    <span class="keyword">if</span> (err) {
      <span class="variable language_">console</span>.<span class="title function_">error</span>(err);
      <span class="keyword">return</span>;
    }
    <span class="variable language_">console</span>.<span class="title function_">log</span>(data);
  });
} <span class="keyword">else</span> {
  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">'Invalid file'</span>);
}</code></pre>

<h4 id="示例2-17"><a href="#示例2-17" class="headerlink" title="示例2"></a>示例2</h4><p>vul</p>
<pre><code class="highlight javascript"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);
<span class="keyword">const</span> fileName = req.<span class="property">query</span>.<span class="property">file</span>;
<span class="keyword">const</span> fileLocation = <span class="string">'/path/to/files/'</span> + fileName;

res.<span class="title function_">download</span>(fileLocation);</code></pre>

<p>fix</p>
<pre><code class="highlight javascript"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>);
<span class="keyword">const</span> allowedDir = <span class="string">'/path/to/allowed/directory/'</span>;
<span class="keyword">const</span> fileName = req.<span class="property">query</span>.<span class="property">file</span>;
<span class="keyword">const</span> filePath = path.<span class="title function_">join</span>(allowedDir, fileName);

<span class="keyword">if</span> (path.<span class="title function_">resolve</span>(filePath).<span class="title function_">startsWith</span>(path.<span class="title function_">resolve</span>(allowedDir))) {
  res.<span class="title function_">download</span>(filePath);
} <span class="keyword">else</span> {
  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">'Invalid file'</span>);
}</code></pre>

<h3 id="python-6"><a href="#python-6" class="headerlink" title="python"></a>python</h3><h4 id="示例1-18"><a href="#示例1-18" class="headerlink" title="示例1"></a>示例1</h4><p>vul</p>
<pre><code class="highlight python">file = request.args.get(<span class="string">'file'</span>)
<span class="keyword">with</span> <span class="built_in">open</span>(file, <span class="string">'r'</span>) <span class="keyword">as</span> f:
    content = f.read()
    <span class="built_in">print</span>(content)</code></pre>

<p>fix</p>
<pre><code class="highlight python">allowed_dir = <span class="string">'/path/to/allowed/directory/'</span>
file = request.args.get(<span class="string">'file'</span>)
file_path = os.path.join(allowed_dir, file)

<span class="keyword">if</span> os.path.realpath(file_path).startswith(os.path.realpath(allowed_dir)):
    <span class="keyword">with</span> <span class="built_in">open</span>(file_path, <span class="string">'r'</span>) <span class="keyword">as</span> f:
        content = f.read()
        <span class="built_in">print</span>(content)
<span class="keyword">else</span>:
    <span class="built_in">print</span>(<span class="string">'Invalid file'</span>)</code></pre>

<h4 id="示例2-18"><a href="#示例2-18" class="headerlink" title="示例2"></a>示例2</h4><p>vul</p>
<pre><code class="highlight python">file = request.args.get(<span class="string">'file'</span>)
file_location = <span class="string">'/path/to/files/'</span> + file
<span class="keyword">return</span> send_file(file_location, as_attachment=<span class="literal">True</span>)</code></pre>

<p>fix</p>
<pre><code class="highlight python">allowed_dir = <span class="string">'/path/to/allowed/directory/'</span>
file = request.args.get(<span class="string">'file'</span>)
file_path = os.path.join(allowed_dir, file)

<span class="keyword">if</span> os.path.realpath(file_path).startswith(os.path.realpath(allowed_dir)):
    <span class="keyword">return</span> send_file(file_path, as_attachment=<span class="literal">True</span>)
<span class="keyword">else</span>:
    <span class="built_in">print</span>(<span class="string">'Invalid file'</span>)</code></pre>

<h2 id="文件上传"><a href="#文件上传" class="headerlink" title="文件上传"></a>文件上传</h2><h3 id="php-7"><a href="#php-7" class="headerlink" title="php"></a>php</h3><h4 id="示例1-19"><a href="#示例1-19" class="headerlink" title="示例1"></a>示例1</h4><p>vul</p>
<pre><code class="highlight php"><span class="variable">$targetDir</span> = <span class="string">"uploads/"</span>;
<span class="variable">$targetFile</span> = <span class="variable">$targetDir</span> . <span class="title function_ invoke__">basename</span>(<span class="variable">$_FILES</span>[<span class="string">"file"</span>][<span class="string">"name"</span>]);
<span class="title function_ invoke__">move_uploaded_file</span>(<span class="variable">$_FILES</span>[<span class="string">"file"</span>][<span class="string">"tmp_name"</span>], <span class="variable">$targetFile</span>);</code></pre>

<p>fix</p>
<pre><code class="highlight php"><span class="variable">$targetDir</span> = <span class="string">"uploads/"</span>;
<span class="variable">$targetFile</span> = <span class="variable">$targetDir</span> . <span class="title function_ invoke__">basename</span>(<span class="variable">$_FILES</span>[<span class="string">"file"</span>][<span class="string">"name"</span>]);
<span class="variable">$allowedExtensions</span> = <span class="keyword">array</span>(<span class="string">"jpg"</span>, <span class="string">"jpeg"</span>, <span class="string">"png"</span>);
<span class="variable">$uploadedExtension</span> = <span class="title function_ invoke__">strtolower</span>(<span class="title function_ invoke__">pathinfo</span>(<span class="variable">$targetFile</span>, PATHINFO_EXTENSION));

<span class="keyword">if</span> (<span class="title function_ invoke__">in_array</span>(<span class="variable">$uploadedExtension</span>, <span class="variable">$allowedExtensions</span>)) {
    <span class="title function_ invoke__">move_uploaded_file</span>(<span class="variable">$_FILES</span>[<span class="string">"file"</span>][<span class="string">"tmp_name"</span>], <span class="variable">$targetFile</span>);
} <span class="keyword">else</span> {
    <span class="keyword">echo</span> <span class="string">"Invalid file type"</span>;
}</code></pre>

<h4 id="示例2-19"><a href="#示例2-19" class="headerlink" title="示例2"></a>示例2</h4><p>vul</p>
<pre><code class="highlight php"><span class="variable">$targetDir</span> = <span class="string">"uploads/"</span>;
<span class="variable">$targetFile</span> = <span class="variable">$targetDir</span> . <span class="variable">$_POST</span>[<span class="string">"filename"</span>];
<span class="title function_ invoke__">move_uploaded_file</span>(<span class="variable">$_FILES</span>[<span class="string">"file"</span>][<span class="string">"tmp_name"</span>], <span class="variable">$targetFile</span>);</code></pre>

<p>fix</p>
<pre><code class="highlight php"><span class="variable">$targetDir</span> = <span class="string">"uploads/"</span>;
<span class="variable">$filename</span> = <span class="variable">$_POST</span>[<span class="string">"filename"</span>];
<span class="variable">$cleanedFilename</span> = <span class="title function_ invoke__">preg_replace</span>(<span class="string">'/[^A-Za-z0-9_.-]/'</span>, <span class="string">''</span>, <span class="variable">$filename</span>);
<span class="variable">$targetFile</span> = <span class="variable">$targetDir</span> . <span class="variable">$cleanedFilename</span>;

<span class="keyword">if</span> (<span class="variable">$filename</span> === <span class="variable">$cleanedFilename</span>) {
    <span class="title function_ invoke__">move_uploaded_file</span>(<span class="variable">$_FILES</span>[<span class="string">"file"</span>][<span class="string">"tmp_name"</span>], <span class="variable">$targetFile</span>);
} <span class="keyword">else</span> {
    <span class="keyword">echo</span> <span class="string">"Invalid filename"</span>;
}</code></pre>

<h3 id="java-7"><a href="#java-7" class="headerlink" title="java"></a>java</h3><h4 id="示例1-20"><a href="#示例1-20" class="headerlink" title="示例1"></a>示例1</h4><p>vul</p>
<pre><code class="highlight java"><span class="type">String</span> <span class="variable">uploadDir</span> <span class="operator">=</span> <span class="string">"/path/to/uploads/"</span>;
<span class="type">Part</span> <span class="variable">filePart</span> <span class="operator">=</span> request.getPart(<span class="string">"file"</span>);
<span class="type">String</span> <span class="variable">fileName</span> <span class="operator">=</span> getSubmittedFileName(filePart);
<span class="type">String</span> <span class="variable">targetFile</span> <span class="operator">=</span> uploadDir + fileName;
filePart.write(targetFile);</code></pre>

<p>fix</p>
<pre><code class="highlight java"><span class="type">String</span> <span class="variable">uploadDir</span> <span class="operator">=</span> <span class="string">"/path/to/uploads/"</span>;
<span class="type">Part</span> <span class="variable">filePart</span> <span class="operator">=</span> request.getPart(<span class="string">"file"</span>);
<span class="type">String</span> <span class="variable">fileName</span> <span class="operator">=</span> getSubmittedFileName(filePart);
<span class="type">String</span> <span class="variable">targetFile</span> <span class="operator">=</span> uploadDir + fileName;

String[] allowedExtensions = {<span class="string">"jpg"</span>, <span class="string">"jpeg"</span>, <span class="string">"png"</span>};
<span class="type">String</span> <span class="variable">uploadedExtension</span> <span class="operator">=</span> fileName.substring(fileName.lastIndexOf(<span class="string">'.'</span>) + <span class="number">1</span>).toLowerCase();

<span class="keyword">if</span> (Arrays.asList(allowedExtensions).contains(uploadedExtension)) {
    filePart.write(targetFile);
} <span class="keyword">else</span> {
    System.out.println(<span class="string">"Invalid file type"</span>);
}</code></pre>

<h4 id="示例2-20"><a href="#示例2-20" class="headerlink" title="示例2"></a>示例2</h4><p>vul</p>
<pre><code class="highlight java"><span class="type">String</span> <span class="variable">uploadDir</span> <span class="operator">=</span> <span class="string">"/path/to/uploads/"</span>;
<span class="type">String</span> <span class="variable">fileName</span> <span class="operator">=</span> request.getParameter(<span class="string">"filename"</span>);
<span class="type">String</span> <span class="variable">targetFile</span> <span class="operator">=</span> uploadDir + fileName;
<span class="type">Part</span> <span class="variable">filePart</span> <span class="operator">=</span> request.getPart(<span class="string">"file"</span>);
filePart.write(targetFile);</code></pre>

<p>fix</p>
<pre><code class="highlight java"><span class="type">String</span> <span class="variable">uploadDir</span> <span class="operator">=</span> <span class="string">"/path/to/uploads/"</span>;
<span class="type">String</span> <span class="variable">fileName</span> <span class="operator">=</span> request.getParameter(<span class="string">"filename"</span>);
<span class="type">String</span> <span class="variable">cleanedFileName</span> <span class="operator">=</span> fileName.replaceAll(<span class="string">"[^A-Za-z0-9_.-]"</span>, <span class="string">""</span>);
<span class="type">String</span> <span class="variable">targetFile</span> <span class="operator">=</span> uploadDir + cleanedFileName;
<span class="type">Part</span> <span class="variable">filePart</span> <span class="operator">=</span> request.getPart(<span class="string">"file"</span>);

<span class="keyword">if</span> (fileName.equals(cleanedFileName)) {
    filePart.write(targetFile);
} <span class="keyword">else</span> {
    System.out.println(<span class="string">"Invalid filename"</span>);
}</code></pre>

<h3 id="nodejs-7"><a href="#nodejs-7" class="headerlink" title="nodejs"></a>nodejs</h3><h4 id="示例1-21"><a href="#示例1-21" class="headerlink" title="示例1"></a>示例1</h4><p>vul</p>
<pre><code class="highlight javascript"><span class="keyword">const</span> uploadDir = <span class="string">'/path/to/uploads/'</span>;
<span class="keyword">const</span> targetFile = uploadDir + req.<span class="property">files</span>.<span class="property">file</span>.<span class="property">name</span>;
req.<span class="property">files</span>.<span class="property">file</span>.<span class="title function_">mv</span>(targetFile, <span class="function">(<span class="params">err</span>) =&gt;</span> {
  <span class="keyword">if</span> (err) {
    <span class="variable language_">console</span>.<span class="title function_">log</span>(err);
  } <span class="keyword">else</span> {
    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">'File uploaded successfully'</span>);
  }
});</code></pre>

<p>fix</p>
<pre><code class="highlight javascript"><span class="keyword">const</span> uploadDir = <span class="string">'/path/to/uploads/'</span>;
<span class="keyword">const</span> targetFile = uploadDir + req.<span class="property">files</span>.<span class="property">file</span>.<span class="property">name</span>;
<span class="keyword">const</span> allowedExtensions = [<span class="string">'jpg'</span>, <span class="string">'jpeg'</span>, <span class="string">'png'</span>];
<span class="keyword">const</span> uploadedExtension = req.<span class="property">files</span>.<span class="property">file</span>.<span class="property">name</span>.<span class="title function_">split</span>(<span class="string">'.'</span>).<span class="title function_">pop</span>().<span class="title function_">toLowerCase</span>();

<span class="keyword">if</span> (allowedExtensions.<span class="title function_">includes</span>(uploadedExtension)) {
  req.<span class="property">files</span>.<span class="property">file</span>.<span class="title function_">mv</span>(targetFile, <span class="function">(<span class="params">err</span>) =&gt;</span> {
    <span class="keyword">if</span> (err) {
      <span class="variable language_">console</span>.<span class="title function_">log</span>(err);
    } <span class="keyword">else</span> {
      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">'File uploaded successfully'</span>);
    }
  });
} <span class="keyword">else</span> {
  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">'Invalid file type'</span>);
}</code></pre>

<h4 id="示例2-21"><a href="#示例2-21" class="headerlink" title="示例2"></a>示例2</h4><p>vul</p>
<pre><code class="highlight javascript"><span class="keyword">const</span> uploadDir = <span class="string">'/path/to/uploads/'</span>;
<span class="keyword">const</span> targetFile = uploadDir + req.<span class="property">body</span>.<span class="property">filename</span>;
req.<span class="property">files</span>.<span class="property">file</span>.<span class="title function_">mv</span>(targetFile, <span class="function">(<span class="params">err</span>) =&gt;</span> {
  <span class="keyword">if</span> (err) {
    <span class="variable language_">console</span>.<span class="title function_">log</span>(err);
  } <span class="keyword">else</span> {
    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">'File uploaded successfully'</span>);
  }
});</code></pre>

<p>fix</p>
<pre><code class="highlight java"><span class="type">const</span> <span class="variable">uploadDir</span> <span class="operator">=</span> <span class="string">'/path/to/uploads/'</span>;
<span class="type">const</span> <span class="variable">filename</span> <span class="operator">=</span> req.body.filename;
<span class="type">const</span> <span class="variable">cleanedFilename</span> <span class="operator">=</span> filename.replace(/[^A-Za-z0-9_.-]/g, <span class="string">''</span>);
<span class="type">const</span> <span class="variable">targetFile</span> <span class="operator">=</span> uploadDir + cleanedFilename;

<span class="keyword">if</span> (filename === cleanedFilename) {
  req.files.file.mv(targetFile, (err) =&gt; {
    <span class="keyword">if</span> (err) {
      console.log(err);
    } <span class="keyword">else</span> {
      console.log(<span class="string">'File uploaded successfully'</span>);
    }
  });
} <span class="keyword">else</span> {
  console.log(<span class="string">'Invalid filename'</span>);
}</code></pre>

<h3 id="python-7"><a href="#python-7" class="headerlink" title="python"></a>python</h3><h4 id="示例1-22"><a href="#示例1-22" class="headerlink" title="示例1"></a>示例1</h4><p>vul</p>
<pre><code class="highlight python">upload_dir = <span class="string">'/path/to/uploads/'</span>
file = request.files[<span class="string">'file'</span>]
file.save(os.path.join(upload_dir, file.filename))</code></pre>

<p>fix</p>
<pre><code class="highlight python">upload_dir = <span class="string">'/path/to/uploads/'</span>
file = request.files[<span class="string">'file'</span>]
allowed_extensions = [<span class="string">'jpg'</span>, <span class="string">'jpeg'</span>, <span class="string">'png'</span>]
uploaded_extension = file.filename.rsplit(<span class="string">'.'</span>, <span class="number">1</span>)[<span class="number">1</span>].lower()

<span class="keyword">if</span> uploaded_extension <span class="keyword">in</span> allowed_extensions:
    file.save(os.path.join(upload_dir, file.filename))
<span class="keyword">else</span>:
    <span class="built_in">print</span>(<span class="string">'Invalid file type'</span>)</code></pre>

<h4 id="示例2-22"><a href="#示例2-22" class="headerlink" title="示例2"></a>示例2</h4><p>vul</p>
<pre><code class="highlight python">upload_dir = <span class="string">'/path/to/uploads/'</span>
filename = request.form[<span class="string">'filename'</span>]
file = request.files[<span class="string">'file'</span>]
file.save(os.path.join(upload_dir, filename))</code></pre>

<p>fix</p>
<pre><code class="highlight python"><span class="keyword">import</span> re

upload_dir = <span class="string">'/path/to/uploads/'</span>
filename = request.form[<span class="string">'filename'</span>]
cleaned_filename = re.sub(<span class="string">r'[^A-Za-z0-9_.-]'</span>, <span class="string">''</span>, filename)
file = request.files[<span class="string">'file'</span>]

<span class="keyword">if</span> filename == cleaned_filename:
    file.save(os.path.join(upload_dir, cleaned_filename))
<span class="keyword">else</span>:
    <span class="built_in">print</span>(<span class="string">'Invalid filename'</span>)</code></pre>

<h2 id="文件包含"><a href="#文件包含" class="headerlink" title="文件包含"></a>文件包含</h2><p>应该和上面的文件读取，目录穿越差不多</p>
<h2 id="XXE"><a href="#XXE" class="headerlink" title="XXE"></a>XXE</h2><h3 id="php-8"><a href="#php-8" class="headerlink" title="php"></a>php</h3><h4 id="示例1-23"><a href="#示例1-23" class="headerlink" title="示例1"></a>示例1</h4><p>vul 使用简单XML解析器</p>
<pre><code class="highlight php"><span class="variable">$xmlData</span> = <span class="variable">$_POST</span>[<span class="string">'xmlData'</span>];
<span class="variable">$xml</span> = <span class="title function_ invoke__">simplexml_load_string</span>(<span class="variable">$xmlData</span>);</code></pre>

<p>fix</p>
<pre><code class="highlight php"><span class="variable">$loadEntities</span> = <span class="title function_ invoke__">libxml_disable_entity_loader</span>(<span class="literal">true</span>);
<span class="variable">$xmlData</span> = <span class="variable">$_POST</span>[<span class="string">'xmlData'</span>];
<span class="variable">$xml</span> = <span class="title function_ invoke__">simplexml_load_string</span>(<span class="variable">$xmlData</span>, <span class="string">'SimpleXMLElement'</span>, LIBXML_NOENT);
<span class="title function_ invoke__">libxml_disable_entity_loader</span>(<span class="variable">$loadEntities</span>);</code></pre>

<h4 id="示例2-23"><a href="#示例2-23" class="headerlink" title="示例2"></a>示例2</h4><p>vul 使用DOM解析器</p>
<pre><code class="highlight php"><span class="variable">$xmlData</span> = <span class="variable">$_POST</span>[<span class="string">'xmlData'</span>];
<span class="variable">$dom</span> = <span class="keyword">new</span> <span class="title class_">DOMDocument</span>();
<span class="variable">$dom</span>-&gt;<span class="title function_ invoke__">loadXML</span>(<span class="variable">$xmlData</span>);</code></pre>

<p>fix</p>
<pre><code class="highlight php"><span class="variable">$dom</span> = <span class="keyword">new</span> <span class="title class_">DOMDocument</span>();
<span class="variable">$loadEntities</span> = <span class="title function_ invoke__">libxml_disable_entity_loader</span>(<span class="literal">true</span>);
<span class="variable">$xmlData</span> = <span class="variable">$_POST</span>[<span class="string">'xmlData'</span>];
<span class="variable">$dom</span>-&gt;<span class="title function_ invoke__">loadXML</span>(<span class="variable">$xmlData</span>, LIBXML_NOENT);
<span class="title function_ invoke__">libxml_disable_entity_loader</span>(<span class="variable">$loadEntities</span>);</code></pre>

<h4 id="示例3-7"><a href="#示例3-7" class="headerlink" title="示例3"></a>示例3</h4><p>vul 使用XMLReader</p>
<pre><code class="highlight php"><span class="variable">$xmlData</span> = <span class="variable">$_POST</span>[<span class="string">'xmlData'</span>];
<span class="variable">$reader</span> = <span class="keyword">new</span> <span class="title class_">XMLReader</span>();
<span class="variable">$reader</span>-&gt;<span class="title function_ invoke__">xml</span>(<span class="variable">$xmlData</span>);</code></pre>

<p>fix</p>
<pre><code class="highlight php"><span class="variable">$reader</span> = <span class="keyword">new</span> <span class="title class_">XMLReader</span>();
<span class="variable">$reader</span>-&gt;<span class="title function_ invoke__">XML</span>(<span class="variable">$_POST</span>[<span class="string">'xmlData'</span>], <span class="literal">null</span>, LIBXML_NOENT);</code></pre>

<h3 id="java-8"><a href="#java-8" class="headerlink" title="java"></a>java</h3><h4 id="示例1-24"><a href="#示例1-24" class="headerlink" title="示例1"></a>示例1</h4><p>vul 使用简单的XML解析器</p>
<pre><code class="highlight java"><span class="type">String</span> <span class="variable">xmlData</span> <span class="operator">=</span> request.getParameter(<span class="string">"xmlData"</span>);
<span class="type">DocumentBuilderFactory</span> <span class="variable">factory</span> <span class="operator">=</span> DocumentBuilderFactory.newInstance();
<span class="type">DocumentBuilder</span> <span class="variable">builder</span> <span class="operator">=</span> factory.newDocumentBuilder();
<span class="type">Document</span> <span class="variable">doc</span> <span class="operator">=</span> builder.parse(<span class="keyword">new</span> <span class="title class_">InputSource</span>(<span class="keyword">new</span> <span class="title class_">StringReader</span>(xmlData)));</code></pre>

<p>fix</p>
<pre><code class="highlight java"><span class="type">String</span> <span class="variable">xmlData</span> <span class="operator">=</span> request.getParameter(<span class="string">"xmlData"</span>);
<span class="type">DocumentBuilderFactory</span> <span class="variable">factory</span> <span class="operator">=</span> DocumentBuilderFactory.newInstance();
factory.setFeature(XMLConstants.FEATURE_SECURE_PROCESSING, <span class="literal">true</span>);
factory.setFeature(<span class="string">"http://apache.org/xml/features/disallow-doctype-decl"</span>, <span class="literal">true</span>);
<span class="type">DocumentBuilder</span> <span class="variable">builder</span> <span class="operator">=</span> factory.newDocumentBuilder();
<span class="type">Document</span> <span class="variable">doc</span> <span class="operator">=</span> builder.parse(<span class="keyword">new</span> <span class="title class_">InputSource</span>(<span class="keyword">new</span> <span class="title class_">StringReader</span>(xmlData)));</code></pre>

<h4 id="示例2-24"><a href="#示例2-24" class="headerlink" title="示例2"></a>示例2</h4><p>vul 使用SAX解析器</p>
<pre><code class="highlight java"><span class="type">String</span> <span class="variable">xmlData</span> <span class="operator">=</span> request.getParameter(<span class="string">"xmlData"</span>);
<span class="type">SAXParserFactory</span> <span class="variable">factory</span> <span class="operator">=</span> SAXParserFactory.newInstance();
<span class="type">SAXParser</span> <span class="variable">parser</span> <span class="operator">=</span> factory.newSAXParser();
<span class="type">XMLReader</span> <span class="variable">reader</span> <span class="operator">=</span> parser.getXMLReader();
reader.parse(<span class="keyword">new</span> <span class="title class_">InputSource</span>(<span class="keyword">new</span> <span class="title class_">StringReader</span>(xmlData)));</code></pre>

<p>fix</p>
<pre><code class="highlight java"><span class="type">String</span> <span class="variable">xmlData</span> <span class="operator">=</span> request.getParameter(<span class="string">"xmlData"</span>);
<span class="type">SAXParserFactory</span> <span class="variable">factory</span> <span class="operator">=</span> SAXParserFactory.newInstance();
factory.setFeature(XMLConstants.FEATURE_SECURE_PROCESSING, <span class="literal">true</span>);
factory.setFeature(<span class="string">"http://apache.org/xml/features/disallow-doctype-decl"</span>, <span class="literal">true</span>);
<span class="type">SAXParser</span> <span class="variable">parser</span> <span class="operator">=</span> factory.newSAXParser();
<span class="type">XMLReader</span> <span class="variable">reader</span> <span class="operator">=</span> parser.getXMLReader();
reader.parse(<span class="keyword">new</span> <span class="title class_">InputSource</span>(<span class="keyword">new</span> <span class="title class_">StringReader</span>(xmlData)));</code></pre>

<h4 id="示例3-8"><a href="#示例3-8" class="headerlink" title="示例3"></a>示例3</h4><p>vul 使用JAXB解析器</p>
<pre><code class="highlight java"><span class="type">String</span> <span class="variable">xmlData</span> <span class="operator">=</span> request.getParameter(<span class="string">"xmlData"</span>);
<span class="type">JAXBContext</span> <span class="variable">context</span> <span class="operator">=</span> JAXBContext.newInstance(MyData.class);
<span class="type">Unmarshaller</span> <span class="variable">unmarshaller</span> <span class="operator">=</span> context.createUnmarshaller();
<span class="type">MyData</span> <span class="variable">data</span> <span class="operator">=</span> (MyData) unmarshaller.unmarshal(<span class="keyword">new</span> <span class="title class_">StringReader</span>(xmlData));</code></pre>

<p>fix</p>
<pre><code class="highlight java"><span class="type">String</span> <span class="variable">xmlData</span> <span class="operator">=</span> request.getParameter(<span class="string">"xmlData"</span>);
<span class="type">DocumentBuilderFactory</span> <span class="variable">factory</span> <span class="operator">=</span> DocumentBuilderFactory.newInstance();
factory.setFeature(XMLConstants.FEATURE_SECURE_PROCESSING, <span class="literal">true</span>);
factory.setFeature(<span class="string">"http://apache.org/xml/features/disallow-doctype-decl"</span>, <span class="literal">true</span>);
<span class="type">DocumentBuilder</span> <span class="variable">builder</span> <span class="operator">=</span> factory.newDocumentBuilder();
<span class="type">InputSource</span> <span class="variable">is</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">InputSource</span>(<span class="keyword">new</span> <span class="title class_">StringReader</span>(xmlData));
<span class="type">Document</span> <span class="variable">doc</span> <span class="operator">=</span> builder.parse(is);
<span class="type">JAXBContext</span> <span class="variable">context</span> <span class="operator">=</span> JAXBContext.newInstance(MyData.class);
<span class="type">Unmarshaller</span> <span class="variable">unmarshaller</span> <span class="operator">=</span> context.createUnmarshaller();
<span class="type">MyData</span> <span class="variable">data</span> <span class="operator">=</span> (MyData) unmarshaller.unmarshal(doc);</code></pre>

<h3 id="nodejs-8"><a href="#nodejs-8" class="headerlink" title="nodejs"></a>nodejs</h3><h4 id="示例1-25"><a href="#示例1-25" class="headerlink" title="示例1"></a>示例1</h4><p>vul 使用<code>xml2js</code>模块解析XML</p>
<pre><code class="highlight javascript"><span class="keyword">const</span> xml2js = <span class="built_in">require</span>(<span class="string">'xml2js'</span>);
<span class="keyword">const</span> xmlData = req.<span class="property">body</span>.<span class="property">xmlData</span>;
xml2js.<span class="title function_">parseString</span>(xmlData, <span class="function">(<span class="params">err, result</span>) =&gt;</span> {
  <span class="comment">// 处理解析后的结果</span>
});</code></pre>

<p>fix</p>
<pre><code class="highlight javascript"><span class="keyword">const</span> xml2js = <span class="built_in">require</span>(<span class="string">'xml2js'</span>);
<span class="keyword">const</span> xmlData = req.<span class="property">body</span>.<span class="property">xmlData</span>;
<span class="keyword">const</span> parser = <span class="keyword">new</span> xml2js.<span class="title class_">Parser</span>({ 
  <span class="comment">// 禁用外部实体解析</span>
  <span class="attr">explicitCharkey</span>: <span class="literal">false</span>,
  <span class="attr">explicitRoot</span>: <span class="literal">false</span>,
  <span class="attr">explicitArray</span>: <span class="literal">false</span>,
  <span class="attr">ignoreAttrs</span>: <span class="literal">false</span>,
  <span class="attr">mergeAttrs</span>: <span class="literal">false</span>,
  <span class="attr">validator</span>: <span class="literal">null</span>,
  <span class="attr">xmlns</span>: <span class="literal">false</span>,
  <span class="attr">novalidate</span>: <span class="literal">true</span>,
  <span class="attr">noscript</span>: <span class="literal">true</span>,
  <span class="attr">nonet</span>: <span class="literal">true</span>,
  <span class="attr">noblanks</span>: <span class="literal">true</span>,
  <span class="attr">noext</span>: <span class="literal">true</span>,
  <span class="attr">nodtdattr</span>: <span class="literal">true</span>,
  <span class="attr">doctype</span>: <span class="literal">null</span>,
});
parser.<span class="title function_">parseString</span>(xmlData, <span class="function">(<span class="params">err, result</span>) =&gt;</span> {
  <span class="comment">// 处理解析后的XML数据</span>
});</code></pre>

<h4 id="示例2-25"><a href="#示例2-25" class="headerlink" title="示例2"></a>示例2</h4><p>vul 使用<code>xmldom</code>模块进行XML解析</p>
<pre><code class="highlight javascript"><span class="keyword">const</span> { <span class="title class_">DOMParser</span> } = <span class="built_in">require</span>(<span class="string">'xmldom'</span>);
<span class="keyword">const</span> xmlData = req.<span class="property">body</span>.<span class="property">xmlData</span>;
<span class="keyword">const</span> parser = <span class="keyword">new</span> <span class="title class_">DOMParser</span>();
<span class="keyword">const</span> doc = parser.<span class="title function_">parseFromString</span>(xmlData, <span class="string">'application/xml'</span>);</code></pre>

<p>fix</p>
<pre><code class="highlight javascript"><span class="keyword">const</span> { <span class="title class_">DOMParser</span> } = <span class="built_in">require</span>(<span class="string">'xmldom'</span>);
<span class="keyword">const</span> xmlData = req.<span class="property">body</span>.<span class="property">xmlData</span>;
<span class="keyword">const</span> parser = <span class="keyword">new</span> <span class="title class_">DOMParser</span>({
  <span class="comment">// 禁用外部实体解析</span>
  <span class="attr">errorHandler</span>: {
    <span class="attr">warning</span>: <span class="function">() =&gt;</span> {},
    <span class="attr">error</span>: <span class="function">() =&gt;</span> {},
    <span class="attr">fatalError</span>: <span class="function">() =&gt;</span> {},
  },
});
<span class="keyword">const</span> doc = parser.<span class="title function_">parseFromString</span>(xmlData, <span class="string">'application/xml'</span>);</code></pre>

<h3 id="python-8"><a href="#python-8" class="headerlink" title="python"></a>python</h3><h4 id="示例1-26"><a href="#示例1-26" class="headerlink" title="示例1"></a>示例1</h4><p>vul 使用内置的<code>xml.etree.ElementTree</code>模块进行XML解析</p>
<pre><code class="highlight plaintext">import xml.etree.ElementTree as ET
xml_data = request.POST.get('xml_data')
root = ET.fromstring(xml_data)</code></pre>

<p>fix</p>
<pre><code class="highlight plaintext">import xml.etree.ElementTree as ET
from xml.etree.ElementTree import ParseError
xml_data = request.POST.get('xml_data')
try:
    parser = ET.XMLParser()
    parser.entity["file"] = None  # 禁用外部实体解析
    root = ET.fromstring(xml_data, parser=parser)
except ParseError:
    # 处理解析错误</code></pre>

<h4 id="示例2-26"><a href="#示例2-26" class="headerlink" title="示例2"></a>示例2</h4><p>vul 使用<code>defusedxml</code>模块进行XML解析</p>
<pre><code class="highlight python"><span class="keyword">import</span> defusedxml.ElementTree <span class="keyword">as</span> ET
xml_data = request.POST.get(<span class="string">'xml_data'</span>)
root = ET.fromstring(xml_data)</code></pre>

<p>fix</p>
<pre><code class="highlight python"><span class="keyword">import</span> defusedxml.ElementTree <span class="keyword">as</span> ET
<span class="keyword">from</span> defusedxml.common <span class="keyword">import</span> EntitiesForbidden
xml_data = request.POST.get(<span class="string">'xml_data'</span>)
<span class="keyword">try</span>:
    parser = ET.DefusedXMLParser()
    parser.entity[<span class="string">"file"</span>] = <span class="literal">None</span>  <span class="comment"># 禁用外部实体解析</span>
    root = ET.fromstring(xml_data, parser=parser)
<span class="keyword">except</span> EntitiesForbidden:
    <span class="comment"># 处理实体禁止错误</span></code></pre>

<h4 id="示例3-9"><a href="#示例3-9" class="headerlink" title="示例3"></a>示例3</h4><p>vul 使用<code>lxml</code>库进行XML解析</p>
<pre><code class="highlight python"><span class="keyword">from</span> lxml <span class="keyword">import</span> etree
xml_data = request.POST.get(<span class="string">'xml_data'</span>)
root = etree.fromstring(xml_data)</code></pre>

<p>fix</p>
<pre><code class="highlight plaintext">from lxml import etree
xml_data = request.POST.get('xml_data')
parser = etree.XMLParser(resolve_entities=False)  # 禁用外部实体解析
try:
    root = etree.fromstring(xml_data, parser=parser)
except etree.XMLSyntaxError:
    # 处理解析错误</code></pre>

<h2 id="模板注入"><a href="#模板注入" class="headerlink" title="模板注入"></a>模板注入</h2><h3 id="php-9"><a href="#php-9" class="headerlink" title="php"></a>php</h3><h4 id="示例1-27"><a href="#示例1-27" class="headerlink" title="示例1"></a>示例1</h4><p>vul 使用Smarty模板引擎</p>
<pre><code class="highlight php"><span class="variable">$template</span> = <span class="variable">$_GET</span>[<span class="string">'template'</span>];
<span class="variable">$smarty</span>-&gt;<span class="title function_ invoke__">display</span>(<span class="variable">$template</span>);</code></pre>

<p>fix</p>
<pre><code class="highlight php"><span class="variable">$template</span> = <span class="variable">$_GET</span>[<span class="string">'template'</span>];
<span class="variable">$allowedTemplates</span> = <span class="keyword">array</span>(<span class="string">'template1'</span>, <span class="string">'template2'</span>);  <span class="comment">// 允许的模板列表</span>
<span class="keyword">if</span> (<span class="title function_ invoke__">in_array</span>(<span class="variable">$template</span>, <span class="variable">$allowedTemplates</span>)) {
    <span class="variable">$smarty</span>-&gt;<span class="title function_ invoke__">display</span>(<span class="variable">$template</span>);
} <span class="keyword">else</span> {
    <span class="comment">// 显示错误或默认模板</span>
}</code></pre>

<h4 id="示例2-27"><a href="#示例2-27" class="headerlink" title="示例2"></a>示例2</h4><p>vul 使用Twig模板引擎</p>
<pre><code class="highlight php"><span class="variable">$template</span> = <span class="variable">$_GET</span>[<span class="string">'template'</span>];
<span class="keyword">echo</span> <span class="variable">$twig</span>-&gt;<span class="title function_ invoke__">render</span>(<span class="variable">$template</span>, <span class="variable">$data</span>);</code></pre>

<p>fix</p>
<pre><code class="highlight php"><span class="variable">$template</span> = <span class="variable">$_GET</span>[<span class="string">'template'</span>];
<span class="variable">$allowedTemplates</span> = <span class="keyword">array</span>(<span class="string">'template1'</span>, <span class="string">'template2'</span>);  <span class="comment">// 允许的模板列表</span>
<span class="keyword">if</span> (<span class="title function_ invoke__">in_array</span>(<span class="variable">$template</span>, <span class="variable">$allowedTemplates</span>)) {
    <span class="keyword">echo</span> <span class="variable">$twig</span>-&gt;<span class="title function_ invoke__">render</span>(<span class="string">'@secure/'</span> . <span class="variable">$template</span>, <span class="variable">$data</span>);
} <span class="keyword">else</span> {
    <span class="comment">// 显示错误或默认模板</span>
}</code></pre>

<h4 id="示例3-10"><a href="#示例3-10" class="headerlink" title="示例3"></a>示例3</h4><p>vul 使用其他自定义的模板引擎</p>
<pre><code class="highlight php"><span class="variable">$template</span> = <span class="variable">$_GET</span>[<span class="string">'template'</span>];
<span class="title function_ invoke__">renderTemplate</span>(<span class="variable">$template</span>);</code></pre>

<p>fix</p>
<pre><code class="highlight php"><span class="variable">$template</span> = <span class="variable">$_GET</span>[<span class="string">'template'</span>];
<span class="variable">$allowedTemplates</span> = <span class="keyword">array</span>(<span class="string">'template1'</span>, <span class="string">'template2'</span>);  <span class="comment">// 允许的模板列表</span>
<span class="keyword">if</span> (<span class="title function_ invoke__">in_array</span>(<span class="variable">$template</span>, <span class="variable">$allowedTemplates</span>)) {
    <span class="title function_ invoke__">renderTemplate</span>(<span class="variable">$template</span>);
} <span class="keyword">else</span> {
    <span class="comment">// 显示错误或默认模板</span>
}</code></pre>

<h3 id="python-9"><a href="#python-9" class="headerlink" title="python"></a>python</h3><h4 id="示例1-28"><a href="#示例1-28" class="headerlink" title="示例1"></a>示例1</h4><p>vul 使用Jinja2模板引擎</p>
<pre><code class="highlight python"><span class="keyword">from</span> jinja2 <span class="keyword">import</span> Template

template_string = request.GET.get(<span class="string">'template'</span>)
template = Template(template_string)
output = template.render(data=data)</code></pre>

<p>fix</p>
<pre><code class="highlight python"><span class="keyword">from</span> jinja2 <span class="keyword">import</span> Environment, select_autoescape

template_string = request.GET.get(<span class="string">'template'</span>)
env = Environment(autoescape=select_autoescape([<span class="string">'html'</span>, <span class="string">'xml'</span>]))
template = env.from_string(template_string)
output = template.render(data=data)</code></pre>

<h4 id="示例2-28"><a href="#示例2-28" class="headerlink" title="示例2"></a>示例2</h4><p>vul 使用Mako模板引擎</p>
<pre><code class="highlight python"><span class="keyword">from</span> mako.template <span class="keyword">import</span> Template

template_string = request.GET.get(<span class="string">'template'</span>)
template = Template(template_string)
output = template.render(data=data)</code></pre>

<p>fix</p>
<pre><code class="highlight python"><span class="keyword">from</span> mako.template <span class="keyword">import</span> Template
<span class="keyword">from</span> mako <span class="keyword">import</span> exceptions

template_string = request.GET.get(<span class="string">'template'</span>)
<span class="keyword">try</span>:
    template = Template(template_string)
    output = template.render(data=data)
<span class="keyword">except</span> exceptions.TemplateException:
    <span class="comment"># 处理模板异常</span></code></pre>

<h4 id="示例3-11"><a href="#示例3-11" class="headerlink" title="示例3"></a>示例3</h4><p>vul 使用其他自定义的模板引擎</p>
<pre><code class="highlight python">template_string = request.GET.get(<span class="string">'template'</span>)
template = MyCustomTemplate(template_string)
output = template.render(data=data)</code></pre>

<p>fix</p>
<pre><code class="highlight python">template_string = request.GET.get(<span class="string">'template'</span>)
<span class="keyword">if</span> is_valid_template(template_string):
    template = MyCustomTemplate(template_string)
    output = template.render(data=data)
<span class="keyword">else</span>:
    <span class="comment"># 显示错误或默认模板</span></code></pre>

<h3 id="java-9"><a href="#java-9" class="headerlink" title="java"></a>java</h3><h4 id="示例1-29"><a href="#示例1-29" class="headerlink" title="示例1"></a>示例1</h4><p>vul 使用FreeMarker模板引擎</p>
<pre><code class="highlight java"><span class="type">String</span> <span class="variable">template</span> <span class="operator">=</span> request.getParameter(<span class="string">"template"</span>);
<span class="type">Configuration</span> <span class="variable">configuration</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Configuration</span>(Configuration.VERSION_2_3_30);
<span class="type">Template</span> <span class="variable">tpl</span> <span class="operator">=</span> configuration.getTemplate(template);
<span class="type">String</span> <span class="variable">output</span> <span class="operator">=</span> FreeMarkerTemplateUtils.processTemplateIntoString(tpl, model);</code></pre>

<p>fix</p>
<pre><code class="highlight java"><span class="type">String</span> <span class="variable">template</span> <span class="operator">=</span> request.getParameter(<span class="string">"template"</span>);
<span class="type">Configuration</span> <span class="variable">configuration</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Configuration</span>(Configuration.VERSION_2_3_30);
configuration.setTemplateUpdateDelayMilliseconds(<span class="number">0</span>);  <span class="comment">// 禁用模板文件的自动更新</span>
configuration.setTemplateExceptionHandler(TemplateExceptionHandler.RETHROW_HANDLER);  <span class="comment">// 异常处理方式</span>
<span class="type">Template</span> <span class="variable">tpl</span> <span class="operator">=</span> configuration.getTemplate(template);
<span class="type">String</span> <span class="variable">output</span> <span class="operator">=</span> FreeMarkerTemplateUtils.processTemplateIntoString(tpl, model);</code></pre>

<h4 id="示例2-29"><a href="#示例2-29" class="headerlink" title="示例2"></a>示例2</h4><p>vul 使用Velocity模板引擎</p>
<pre><code class="highlight java"><span class="type">String</span> <span class="variable">template</span> <span class="operator">=</span> request.getParameter(<span class="string">"template"</span>);
<span class="type">VelocityContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">VelocityContext</span>();
context.put(<span class="string">"data"</span>, data);
<span class="type">StringWriter</span> <span class="variable">writer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringWriter</span>();
<span class="type">VelocityEngine</span> <span class="variable">ve</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">VelocityEngine</span>();
ve.evaluate(context, writer, <span class="string">"template"</span>, template);
<span class="type">String</span> <span class="variable">output</span> <span class="operator">=</span> writer.toString();</code></pre>

<p>fix</p>
<pre><code class="highlight java"><span class="type">String</span> <span class="variable">template</span> <span class="operator">=</span> request.getParameter(<span class="string">"template"</span>);
<span class="type">VelocityContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">VelocityContext</span>();
context.put(<span class="string">"data"</span>, data);
<span class="type">StringWriter</span> <span class="variable">writer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringWriter</span>();
<span class="type">VelocityEngine</span> <span class="variable">ve</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">VelocityEngine</span>();
ve.setProperty(RuntimeConstants.RUNTIME_LOG_LOGSYSTEM_CLASS, <span class="string">"org.apache.velocity.runtime.log.NullLogSystem"</span>);  <span class="comment">// 禁用日志输出</span>
ve.setProperty(RuntimeConstants.RESOURCE_MANAGER_CLASS, <span class="string">"org.apache.velocity.runtime.resource.manager.StringResourceLoader"</span>);  <span class="comment">// 使用StringResourceLoader加载模板</span>
ve.init();
ve.evaluate(context, writer, <span class="string">"template"</span>, template);
<span class="type">String</span> <span class="variable">output</span> <span class="operator">=</span> writer.toString();</code></pre>

<h4 id="示例3-12"><a href="#示例3-12" class="headerlink" title="示例3"></a>示例3</h4><p>vul 使用其他自定义的模板引擎</p>
<pre><code class="highlight java"><span class="type">String</span> <span class="variable">template</span> <span class="operator">=</span> request.getParameter(<span class="string">"template"</span>);
<span class="type">TemplateEngine</span> <span class="variable">engine</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CustomTemplateEngine</span>();
<span class="type">Template</span> <span class="variable">tpl</span> <span class="operator">=</span> engine.getTemplate(template);
<span class="type">String</span> <span class="variable">output</span> <span class="operator">=</span> tpl.render(data);</code></pre>

<p>fix</p>
<pre><code class="highlight java"><span class="type">String</span> <span class="variable">template</span> <span class="operator">=</span> request.getParameter(<span class="string">"template"</span>);
<span class="type">TemplateEngine</span> <span class="variable">engine</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CustomTemplateEngine</span>();
engine.setSafeMode(<span class="literal">true</span>);  <span class="comment">// 启用安全模式</span>
<span class="type">Template</span> <span class="variable">tpl</span> <span class="operator">=</span> engine.getTemplate(template);
<span class="type">String</span> <span class="variable">output</span> <span class="operator">=</span> tpl.render(data);</code></pre>

<h3 id="nodejs-9"><a href="#nodejs-9" class="headerlink" title="nodejs"></a>nodejs</h3><h4 id="示例1-30"><a href="#示例1-30" class="headerlink" title="示例1"></a>示例1</h4><p>vul 使用EJS模板引擎</p>
<pre><code class="highlight javascript"><span class="keyword">const</span> ejs = <span class="built_in">require</span>(<span class="string">'ejs'</span>);

app.<span class="title function_">get</span>(<span class="string">'/template'</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> {
  <span class="keyword">const</span> template = req.<span class="property">query</span>.<span class="property">template</span>;
  <span class="keyword">const</span> data = {
    <span class="attr">name</span>: <span class="string">'John'</span>,
    <span class="comment">// ...</span>
  };
  <span class="keyword">const</span> output = ejs.<span class="title function_">render</span>(template, data);
  res.<span class="title function_">send</span>(output);
});</code></pre>

<p>fix</p>
<pre><code class="highlight javascript"><span class="keyword">const</span> ejs = <span class="built_in">require</span>(<span class="string">'ejs'</span>);

app.<span class="title function_">get</span>(<span class="string">'/template'</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> {
  <span class="keyword">const</span> template = req.<span class="property">query</span>.<span class="property">template</span>;
  <span class="keyword">const</span> data = {
    <span class="attr">name</span>: <span class="string">'John'</span>,
    <span class="comment">// ...</span>
  };
  <span class="keyword">const</span> options = {
    <span class="comment">// 设置安全的模板配置</span>
    <span class="comment">// ...</span>
  };
  <span class="keyword">const</span> output = ejs.<span class="title function_">render</span>(template, data, options);
  res.<span class="title function_">send</span>(output);
});</code></pre>

<h4 id="示例2-30"><a href="#示例2-30" class="headerlink" title="示例2"></a>示例2</h4><p>vul 使用Handlebars模板引擎</p>
<pre><code class="highlight javascript"><span class="keyword">const</span> handlebars = <span class="built_in">require</span>(<span class="string">'handlebars'</span>);

app.<span class="title function_">get</span>(<span class="string">'/template'</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> {
  <span class="keyword">const</span> template = req.<span class="property">query</span>.<span class="property">template</span>;
  <span class="keyword">const</span> data = {
    <span class="attr">name</span>: <span class="string">'John'</span>,
    <span class="comment">// ...</span>
  };
  <span class="keyword">const</span> output = handlebars.<span class="title function_">compile</span>(template)(data);
  res.<span class="title function_">send</span>(output);
});</code></pre>

<p>fix</p>
<pre><code class="highlight javascript"><span class="keyword">const</span> handlebars = <span class="built_in">require</span>(<span class="string">'handlebars'</span>);

app.<span class="title function_">get</span>(<span class="string">'/template'</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> {
  <span class="keyword">const</span> template = req.<span class="property">query</span>.<span class="property">template</span>;
  <span class="keyword">const</span> data = {
    <span class="attr">name</span>: <span class="string">'John'</span>,
    <span class="comment">// ...</span>
  };
  <span class="keyword">const</span> options = {
    <span class="comment">// 设置安全的模板配置</span>
    <span class="comment">// ...</span>
  };
  <span class="keyword">const</span> output = handlebars.<span class="title function_">compile</span>(template)(data, options);
  res.<span class="title function_">send</span>(output);
});</code></pre>

<h2 id="CSRF"><a href="#CSRF" class="headerlink" title="CSRF"></a>CSRF</h2><h3 id="php-10"><a href="#php-10" class="headerlink" title="php"></a>php</h3><p>vul</p>
<pre><code class="highlight php+HTML">&lt;?php
// 表单处理代码
if (isset($_POST['submit'])) {
    $amount = $_POST['amount'];
    // 处理表单提交逻辑
}
?&gt;

&lt;!-- 表单 --&gt;
&lt;form action="process.php" method="POST"&gt;
    &lt;input type="text" name="amount" value="100"&gt;
    &lt;input type="submit" name="submit" value="Submit"&gt;
&lt;/form&gt;</code></pre>

<p>fix</p>
<pre><code class="highlight php+HTML">&lt;?php
// 生成CSRF令牌
session_start();
if (!isset($_SESSION['csrf_token'])) {
    $_SESSION['csrf_token'] = bin2hex(random_bytes(32));
}

// 表单处理代码
if (isset($_POST['submit'])) {
    // 验证CSRF令牌
    if (!isset($_POST['csrf_token']) || $_POST['csrf_token'] !== $_SESSION['csrf_token']) {
        die('Invalid CSRF token');
    }

    $amount = $_POST['amount'];
    // 处理表单提交逻辑
}
?&gt;

&lt;!-- 表单 --&gt;
&lt;form action="process.php" method="POST"&gt;
    &lt;input type="hidden" name="csrf_token" value="&lt;?php echo $_SESSION['csrf_token']; ?&gt;"&gt;
    &lt;input type="text" name="amount" value="100"&gt;
    &lt;input type="submit" name="submit" value="Submit"&gt;
&lt;/form&gt;</code></pre>

<h3 id="java-10"><a href="#java-10" class="headerlink" title="java"></a>java</h3><p>vul</p>
<pre><code class="highlight java"><span class="meta">@WebServlet("/process")</span>
<span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ProcessServlet</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> {
    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException {
        <span class="type">String</span> <span class="variable">amount</span> <span class="operator">=</span> request.getParameter(<span class="string">"amount"</span>);
        <span class="comment">// 处理表单提交逻辑</span>
    }
}</code></pre>

<p>fix</p>
<pre><code class="highlight java"><span class="meta">@WebServlet("/process")</span>
<span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ProcessServlet</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> {
    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException {
        <span class="type">String</span> <span class="variable">csrfToken</span> <span class="operator">=</span> (String) request.getSession().getAttribute(<span class="string">"csrfToken"</span>);
        <span class="type">String</span> <span class="variable">receivedToken</span> <span class="operator">=</span> request.getParameter(<span class="string">"csrfToken"</span>);

        <span class="comment">// 验证CSRF令牌</span>
        <span class="keyword">if</span> (!csrfToken.equals(receivedToken)) {
            response.sendError(HttpServletResponse.SC_FORBIDDEN, <span class="string">"Invalid CSRF token"</span>);
            <span class="keyword">return</span>;
        }

        <span class="type">String</span> <span class="variable">amount</span> <span class="operator">=</span> request.getParameter(<span class="string">"amount"</span>);
        <span class="comment">// 处理表单提交逻辑</span>
    }
}</code></pre>

<h3 id="nodejs-10"><a href="#nodejs-10" class="headerlink" title="nodejs"></a>nodejs</h3><p>vul</p>
<pre><code class="highlight javascript"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>);
<span class="keyword">const</span> bodyParser = <span class="built_in">require</span>(<span class="string">'body-parser'</span>);

<span class="keyword">const</span> app = <span class="title function_">express</span>();
app.<span class="title function_">use</span>(bodyParser.<span class="title function_">urlencoded</span>({ <span class="attr">extended</span>: <span class="literal">false</span> }));

app.<span class="title function_">post</span>(<span class="string">'/process'</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> {
  <span class="keyword">const</span> amount = req.<span class="property">body</span>.<span class="property">amount</span>;
  <span class="comment">// 处理表单提交逻辑</span>
});

app.<span class="title function_">listen</span>(<span class="number">3000</span>, <span class="function">() =&gt;</span> {
  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">'Server is running on port 3000'</span>);
});</code></pre>

<p>fix</p>
<pre><code class="highlight javascript"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>);
<span class="keyword">const</span> bodyParser = <span class="built_in">require</span>(<span class="string">'body-parser'</span>);
<span class="keyword">const</span> session = <span class="built_in">require</span>(<span class="string">'express-session'</span>);

<span class="keyword">const</span> app = <span class="title function_">express</span>();
app.<span class="title function_">use</span>(bodyParser.<span class="title function_">urlencoded</span>({ <span class="attr">extended</span>: <span class="literal">false</span> }));
app.<span class="title function_">use</span>(<span class="title function_">session</span>({ <span class="attr">secret</span>: <span class="string">'secret'</span>, <span class="attr">resave</span>: <span class="literal">false</span>, <span class="attr">saveUninitialized</span>: <span class="literal">true</span> }));

<span class="comment">// 生成并存储CSRF令牌</span>
app.<span class="title function_">use</span>(<span class="function">(<span class="params">req, res, next</span>) =&gt;</span> {
  <span class="keyword">if</span> (!req.<span class="property">session</span>.<span class="property">csrfToken</span>) {
    req.<span class="property">session</span>.<span class="property">csrfToken</span> = <span class="title function_">generateCsrfToken</span>();
  }
  <span class="title function_">next</span>();
});

app.<span class="title function_">post</span>(<span class="string">'/process'</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> {
  <span class="keyword">const</span> csrfToken = req.<span class="property">session</span>.<span class="property">csrfToken</span>;
  <span class="keyword">const</span> receivedToken = req.<span class="property">body</span>.<span class="property">csrfToken</span>;

  <span class="comment">// 验证CSRF令牌</span>
  <span class="keyword">if</span> (csrfToken !== receivedToken) {
    res.<span class="title function_">status</span>(<span class="number">403</span>).<span class="title function_">send</span>(<span class="string">'Invalid CSRF token'</span>);
    <span class="keyword">return</span>;
  }

  <span class="keyword">const</span> amount = req.<span class="property">body</span>.<span class="property">amount</span>;
  <span class="comment">// 处理表单提交逻辑</span>
});

app.<span class="title function_">listen</span>(<span class="number">3000</span>, <span class="function">() =&gt;</span> {
  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">'Server is running on port 3000'</span>);
});

<span class="comment">// 生成随机的CSRF令牌</span>
<span class="keyword">function</span> <span class="title function_">generateCsrfToken</span>(<span class="params"></span>) {
  <span class="comment">// 生成随机令牌</span>
  <span class="keyword">return</span> <span class="title class_">Math</span>.<span class="title function_">random</span>().<span class="title function_">toString</span>(<span class="number">36</span>).<span class="title function_">substring</span>(<span class="number">2</span>, <span class="number">15</span>) + <span class="title class_">Math</span>.<span class="title function_">random</span>().<span class="title function_">toString</span>(<span class="number">36</span>).<span class="title function_">substring</span>(<span class="number">2</span>, <span class="number">15</span>);
}</code></pre>

<h3 id="python-10"><a href="#python-10" class="headerlink" title="python"></a>python</h3><p>vul</p>
<pre><code class="highlight python"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request

app = Flask(__name__)

<span class="meta">@app.route(<span class="params"><span class="string">'/process'</span>, methods=[<span class="string">'POST'</span>]</span>)</span>
<span class="keyword">def</span> <span class="title function_">process</span>():
    amount = request.form[<span class="string">'amount'</span>]
    <span class="comment"># 处理表单提交逻辑</span>

<span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:
    app.run()</code></pre>

<p>fix</p>
<pre><code class="highlight python"><span class="keyword">import</span> secrets
<span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request, session, abort

app = Flask(__name__)
app.secret_key = <span class="string">'secret'</span>

<span class="comment"># 生成并存储CSRF令牌</span>
<span class="meta">@app.before_request</span>
<span class="keyword">def</span> <span class="title function_">csrf_protect</span>():
    <span class="keyword">if</span> <span class="string">'csrf_token'</span> <span class="keyword">not</span> <span class="keyword">in</span> session:
        session[<span class="string">'csrf_token'</span>] = secrets.token_hex(<span class="number">32</span>)

<span class="meta">@app.route(<span class="params"><span class="string">'/process'</span>, methods=[<span class="string">'POST'</span>]</span>)</span>
<span class="keyword">def</span> <span class="title function_">process</span>():
    csrf_token = session[<span class="string">'csrf_token'</span>]
    received_token = request.form[<span class="string">'csrf_token'</span>]

    <span class="comment"># 验证CSRF令牌</span>
    <span class="keyword">if</span> csrf_token != received_token:
        abort(<span class="number">403</span>, <span class="string">'Invalid CSRF token'</span>)

    amount = request.form[<span class="string">'amount'</span>]
    <span class="comment"># 处理表单提交逻辑</span>

<span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:
    app.run()</code></pre>
</div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/smh.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"></div><div class="author-info__name">Pax</div><div class="author-info__description">最困难处最进步</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">32</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">10</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">22</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/Pax-pq"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content is-expand"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%96%87%E6%A1%A3%E6%94%B6%E5%BD%95%E4%B9%8BAWDP"><span class="toc-number">1.</span> <span class="toc-text">文档收录之AWDP</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#attack"><span class="toc-number">1.1.</span> <span class="toc-text">attack</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%BB%91%E7%99%BD%E5%90%8D%E5%8D%95"><span class="toc-number">1.2.</span> <span class="toc-text">黑白名单</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#php"><span class="toc-number">1.2.1.</span> <span class="toc-text">php</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#java"><span class="toc-number">1.2.2.</span> <span class="toc-text">java</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#nodejs"><span class="toc-number">1.2.3.</span> <span class="toc-text">nodejs</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#python"><span class="toc-number">1.2.4.</span> <span class="toc-text">python</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%9B%BF%E6%8D%A2"><span class="toc-number">1.3.</span> <span class="toc-text">字符串替换</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#PHP%EF%BC%9A"><span class="toc-number">1.3.1.</span> <span class="toc-text">PHP：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Python%EF%BC%9A"><span class="toc-number">1.3.2.</span> <span class="toc-text">Python：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Java%EF%BC%9A"><span class="toc-number">1.3.3.</span> <span class="toc-text">Java：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Node-js%EF%BC%9A"><span class="toc-number">1.3.4.</span> <span class="toc-text">Node.js：</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SQLi"><span class="toc-number">1.4.</span> <span class="toc-text">SQLi</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#php-1"><span class="toc-number">1.4.1.</span> <span class="toc-text">php</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#mysqli"><span class="toc-number">1.4.1.1.</span> <span class="toc-text">mysqli</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#PDO"><span class="toc-number">1.4.1.2.</span> <span class="toc-text">PDO</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#mysql"><span class="toc-number">1.4.1.3.</span> <span class="toc-text">mysql</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#java-1"><span class="toc-number">1.4.2.</span> <span class="toc-text">java</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#JDBC"><span class="toc-number">1.4.2.1.</span> <span class="toc-text">JDBC</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ORM"><span class="toc-number">1.4.2.2.</span> <span class="toc-text">ORM</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#nodejs-1"><span class="toc-number">1.4.3.</span> <span class="toc-text">nodejs</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#mysql-1"><span class="toc-number">1.4.3.1.</span> <span class="toc-text">mysql</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#mysql2"><span class="toc-number">1.4.3.2.</span> <span class="toc-text">mysql2</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Sequelize"><span class="toc-number">1.4.3.3.</span> <span class="toc-text">Sequelize</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#python-1"><span class="toc-number">1.4.4.</span> <span class="toc-text">python</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#MySQLdb"><span class="toc-number">1.4.4.1.</span> <span class="toc-text">MySQLdb</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#PyMySQL"><span class="toc-number">1.4.4.2.</span> <span class="toc-text">PyMySQL</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#mysql-connector-python"><span class="toc-number">1.4.4.3.</span> <span class="toc-text">mysql-connector-python</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#XSS"><span class="toc-number">1.5.</span> <span class="toc-text">XSS</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#php-2"><span class="toc-number">1.5.1.</span> <span class="toc-text">php</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#java-2"><span class="toc-number">1.5.2.</span> <span class="toc-text">java</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B1"><span class="toc-number">1.5.2.1.</span> <span class="toc-text">示例1</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B2"><span class="toc-number">1.5.2.2.</span> <span class="toc-text">示例2</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B3"><span class="toc-number">1.5.2.3.</span> <span class="toc-text">示例3</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#nodejs-2"><span class="toc-number">1.5.3.</span> <span class="toc-text">nodejs</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B1-1"><span class="toc-number">1.5.3.1.</span> <span class="toc-text">示例1</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B2-1"><span class="toc-number">1.5.3.2.</span> <span class="toc-text">示例2</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B3-1"><span class="toc-number">1.5.3.3.</span> <span class="toc-text">示例3</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#python-2"><span class="toc-number">1.5.4.</span> <span class="toc-text">python</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B1-2"><span class="toc-number">1.5.4.1.</span> <span class="toc-text">示例1</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B2-2"><span class="toc-number">1.5.4.2.</span> <span class="toc-text">示例2</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B3-2"><span class="toc-number">1.5.4.3.</span> <span class="toc-text">示例3</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SSRF"><span class="toc-number">1.6.</span> <span class="toc-text">SSRF</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#php-3"><span class="toc-number">1.6.1.</span> <span class="toc-text">php</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B1-3"><span class="toc-number">1.6.1.1.</span> <span class="toc-text">示例1</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B2-3"><span class="toc-number">1.6.1.2.</span> <span class="toc-text">示例2</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#java-3"><span class="toc-number">1.6.2.</span> <span class="toc-text">java</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B1-4"><span class="toc-number">1.6.2.1.</span> <span class="toc-text">示例1</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B2-4"><span class="toc-number">1.6.2.2.</span> <span class="toc-text">示例2</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#python-3"><span class="toc-number">1.6.3.</span> <span class="toc-text">python</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B1-5"><span class="toc-number">1.6.3.1.</span> <span class="toc-text">示例1</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B2-5"><span class="toc-number">1.6.3.2.</span> <span class="toc-text">示例2</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#nodejs-3"><span class="toc-number">1.6.4.</span> <span class="toc-text">nodejs</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B1-6"><span class="toc-number">1.6.4.1.</span> <span class="toc-text">示例1</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B2-6"><span class="toc-number">1.6.4.2.</span> <span class="toc-text">示例2</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%91%BD%E4%BB%A4%E6%B3%A8%E5%85%A5"><span class="toc-number">1.7.</span> <span class="toc-text">命令注入</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#php-4"><span class="toc-number">1.7.1.</span> <span class="toc-text">php</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B1-7"><span class="toc-number">1.7.1.1.</span> <span class="toc-text">示例1</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B2-7"><span class="toc-number">1.7.1.2.</span> <span class="toc-text">示例2</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B3-3"><span class="toc-number">1.7.1.3.</span> <span class="toc-text">示例3</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#java-4"><span class="toc-number">1.7.2.</span> <span class="toc-text">java</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B1-8"><span class="toc-number">1.7.2.1.</span> <span class="toc-text">示例1</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B2-8"><span class="toc-number">1.7.2.2.</span> <span class="toc-text">示例2</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#nodejs-4"><span class="toc-number">1.7.3.</span> <span class="toc-text">nodejs</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B1-9"><span class="toc-number">1.7.3.1.</span> <span class="toc-text">示例1</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B2-9"><span class="toc-number">1.7.3.2.</span> <span class="toc-text">示例2</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#python-4"><span class="toc-number">1.7.4.</span> <span class="toc-text">python</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B1-10"><span class="toc-number">1.7.4.1.</span> <span class="toc-text">示例1</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B2-10"><span class="toc-number">1.7.4.2.</span> <span class="toc-text">示例2</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B3-4"><span class="toc-number">1.7.4.3.</span> <span class="toc-text">示例3</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%9B%AE%E5%BD%95%E7%A9%BF%E8%B6%8A"><span class="toc-number">1.8.</span> <span class="toc-text">目录穿越</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#php-5"><span class="toc-number">1.8.1.</span> <span class="toc-text">php</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B1-11"><span class="toc-number">1.8.1.1.</span> <span class="toc-text">示例1</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B2-11"><span class="toc-number">1.8.1.2.</span> <span class="toc-text">示例2</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B3-5"><span class="toc-number">1.8.1.3.</span> <span class="toc-text">示例3</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#java-5"><span class="toc-number">1.8.2.</span> <span class="toc-text">java</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B1-12"><span class="toc-number">1.8.2.1.</span> <span class="toc-text">示例1</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B2-12"><span class="toc-number">1.8.2.2.</span> <span class="toc-text">示例2</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#nodejs-5"><span class="toc-number">1.8.3.</span> <span class="toc-text">nodejs</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B1-13"><span class="toc-number">1.8.3.1.</span> <span class="toc-text">示例1</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B2-13"><span class="toc-number">1.8.3.2.</span> <span class="toc-text">示例2</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#python-5"><span class="toc-number">1.8.4.</span> <span class="toc-text">python</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B1-14"><span class="toc-number">1.8.4.1.</span> <span class="toc-text">示例1</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B2-14"><span class="toc-number">1.8.4.2.</span> <span class="toc-text">示例2</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96"><span class="toc-number">1.9.</span> <span class="toc-text">文件读取</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#php-6"><span class="toc-number">1.9.1.</span> <span class="toc-text">php</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B1-15"><span class="toc-number">1.9.1.1.</span> <span class="toc-text">示例1</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B2-15"><span class="toc-number">1.9.1.2.</span> <span class="toc-text">示例2</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B3-6"><span class="toc-number">1.9.1.3.</span> <span class="toc-text">示例3</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#java-6"><span class="toc-number">1.9.2.</span> <span class="toc-text">java</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B1-16"><span class="toc-number">1.9.2.1.</span> <span class="toc-text">示例1</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B2-16"><span class="toc-number">1.9.2.2.</span> <span class="toc-text">示例2</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#nodejs-6"><span class="toc-number">1.9.3.</span> <span class="toc-text">nodejs</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B1-17"><span class="toc-number">1.9.3.1.</span> <span class="toc-text">示例1</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B2-17"><span class="toc-number">1.9.3.2.</span> <span class="toc-text">示例2</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#python-6"><span class="toc-number">1.9.4.</span> <span class="toc-text">python</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B1-18"><span class="toc-number">1.9.4.1.</span> <span class="toc-text">示例1</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B2-18"><span class="toc-number">1.9.4.2.</span> <span class="toc-text">示例2</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0"><span class="toc-number">1.10.</span> <span class="toc-text">文件上传</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#php-7"><span class="toc-number">1.10.1.</span> <span class="toc-text">php</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B1-19"><span class="toc-number">1.10.1.1.</span> <span class="toc-text">示例1</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B2-19"><span class="toc-number">1.10.1.2.</span> <span class="toc-text">示例2</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#java-7"><span class="toc-number">1.10.2.</span> <span class="toc-text">java</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B1-20"><span class="toc-number">1.10.2.1.</span> <span class="toc-text">示例1</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B2-20"><span class="toc-number">1.10.2.2.</span> <span class="toc-text">示例2</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#nodejs-7"><span class="toc-number">1.10.3.</span> <span class="toc-text">nodejs</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B1-21"><span class="toc-number">1.10.3.1.</span> <span class="toc-text">示例1</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B2-21"><span class="toc-number">1.10.3.2.</span> <span class="toc-text">示例2</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#python-7"><span class="toc-number">1.10.4.</span> <span class="toc-text">python</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B1-22"><span class="toc-number">1.10.4.1.</span> <span class="toc-text">示例1</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B2-22"><span class="toc-number">1.10.4.2.</span> <span class="toc-text">示例2</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB"><span class="toc-number">1.11.</span> <span class="toc-text">文件包含</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#XXE"><span class="toc-number">1.12.</span> <span class="toc-text">XXE</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#php-8"><span class="toc-number">1.12.1.</span> <span class="toc-text">php</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B1-23"><span class="toc-number">1.12.1.1.</span> <span class="toc-text">示例1</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B2-23"><span class="toc-number">1.12.1.2.</span> <span class="toc-text">示例2</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B3-7"><span class="toc-number">1.12.1.3.</span> <span class="toc-text">示例3</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#java-8"><span class="toc-number">1.12.2.</span> <span class="toc-text">java</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B1-24"><span class="toc-number">1.12.2.1.</span> <span class="toc-text">示例1</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B2-24"><span class="toc-number">1.12.2.2.</span> <span class="toc-text">示例2</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B3-8"><span class="toc-number">1.12.2.3.</span> <span class="toc-text">示例3</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#nodejs-8"><span class="toc-number">1.12.3.</span> <span class="toc-text">nodejs</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B1-25"><span class="toc-number">1.12.3.1.</span> <span class="toc-text">示例1</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B2-25"><span class="toc-number">1.12.3.2.</span> <span class="toc-text">示例2</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#python-8"><span class="toc-number">1.12.4.</span> <span class="toc-text">python</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B1-26"><span class="toc-number">1.12.4.1.</span> <span class="toc-text">示例1</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B2-26"><span class="toc-number">1.12.4.2.</span> <span class="toc-text">示例2</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B3-9"><span class="toc-number">1.12.4.3.</span> <span class="toc-text">示例3</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5"><span class="toc-number">1.13.</span> <span class="toc-text">模板注入</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#php-9"><span class="toc-number">1.13.1.</span> <span class="toc-text">php</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B1-27"><span class="toc-number">1.13.1.1.</span> <span class="toc-text">示例1</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B2-27"><span class="toc-number">1.13.1.2.</span> <span class="toc-text">示例2</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B3-10"><span class="toc-number">1.13.1.3.</span> <span class="toc-text">示例3</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#python-9"><span class="toc-number">1.13.2.</span> <span class="toc-text">python</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B1-28"><span class="toc-number">1.13.2.1.</span> <span class="toc-text">示例1</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B2-28"><span class="toc-number">1.13.2.2.</span> <span class="toc-text">示例2</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B3-11"><span class="toc-number">1.13.2.3.</span> <span class="toc-text">示例3</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#java-9"><span class="toc-number">1.13.3.</span> <span class="toc-text">java</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B1-29"><span class="toc-number">1.13.3.1.</span> <span class="toc-text">示例1</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B2-29"><span class="toc-number">1.13.3.2.</span> <span class="toc-text">示例2</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B3-12"><span class="toc-number">1.13.3.3.</span> <span class="toc-text">示例3</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#nodejs-9"><span class="toc-number">1.13.4.</span> <span class="toc-text">nodejs</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B1-30"><span class="toc-number">1.13.4.1.</span> <span class="toc-text">示例1</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B2-30"><span class="toc-number">1.13.4.2.</span> <span class="toc-text">示例2</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#CSRF"><span class="toc-number">1.14.</span> <span class="toc-text">CSRF</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#php-10"><span class="toc-number">1.14.1.</span> <span class="toc-text">php</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#java-10"><span class="toc-number">1.14.2.</span> <span class="toc-text">java</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#nodejs-10"><span class="toc-number">1.14.3.</span> <span class="toc-text">nodejs</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#python-10"><span class="toc-number">1.14.4.</span> <span class="toc-text">python</span></a></li></ol></li></ol></li></ol></div></div></div></div></main><footer id="footer"><div id="footer-wrap"></div><div id="footer_button"><ul class="buttons"><li class="icon Email"><span class="bubble">Email</span><a href="mailto:charles_hsu@qq.com"><i class="fa-solid fa-envelope"></i></a></li><li class="icon QQ"><span class="bubble">QQ</span><a href="tencent://Message/?Uin=1191393280&amp;websiteName=q-zone.qq.com&amp;Menu=yes"><i class="fa-brands fa-qq"></i></a></li><li class="icon top"><span class="bubble">top</span><a href="#"><i class="fa-solid fa-angle-up"></i></a></li><li class="icon github"><span class="bubble">Github</span><a target="_blank" rel="noopener" href="https://github.com/charles-hsuz"><i class="fab fa-github"></i></a></li><li class="icon CSDN"><span class="bubble">CSDN</span><a target="_blank" rel="noopener" href="https://blog.csdn.net/CharlesHsuu?type=blog"><i class="fa-solid fa-copyright"></i></a></li></ul></div><div id="Hsu-foot"><div class="footer-group"><h3 class="footer-title">直达</h3><div class="footer-links"><a class="footer-item" href="/">我的主页</a><a class="footer-item" href="/archives">文章归档</a><a class="footer-item" href="/categories">文章分类</a><a class="footer-item" href="/archives">文章归档</a></div></div><div class="footer-group"><h3 class="footer-title">友链·一</h3><div class="footer-links"><a class="footer-item" target="_blank" rel="noopener" href="http://blog.potatowo.top/">PotatOwO ✨</a><a class="footer-item" target="_blank" rel="noopener" href="https://we11s.github.io/">Wells ✨</a><a class="footer-item" target="_blank" rel="noopener" href="https://cina666.github.io/">Sherlock ✨</a><a class="footer-item" target="_blank" rel="noopener" href="http://xzb666-hub.github.io/">Satoru ✨</a></div></div><div class="footer-group"><h3 class="footer-title">友链·二</h3><div class="footer-links"><a class="footer-item" target="_blank" rel="noopener" href="https://s1nec-1o.github.io/">s1nec-1o ✨</a><a class="footer-item" target="_blank" rel="noopener" href="http://starcraft2024.github.io">starcraft ✨</a><a class="footer-item" target="_blank" rel="noopener" href="https://holybeagle.github.io/">Quuiieet✨</a><a class="footer-item" target="_blank" rel="noopener" href="https://mooseqaq.github.io/">MooSe ✨</a></div></div><div class="footer-group"><h3 class="footer-title">导航</h3><div class="footer-links"><a class="footer-item" href="/2024">2024</a><a class="footer-item" href="/poem">诗集</a><a class="footer-item" href="/music">音乐</a><a class="footer-item" href="/about">自我</a></div></div><div class="footer-group"><h3 class="footer-title">协议</h3><div class="footer-links"><a class="footer-item" href="/privacy">隐私协议</a><a class="footer-item" href="/cookies">Cookie</a><a class="footer-item" href="/cc">版权协议</a></div></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="translateLink" type="button" title="简繁转换">简</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js?v=4.14.0-b3"></script><script src="/js/main.js?v=4.14.0-b3"></script><script src="/js/tw_cn.js?v=4.14.0-b3"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.35/dist/fancybox/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload@19.0.5/dist/lazyload.iife.min.js"></script><div class="js-pjax"><script>(() => {
  const runMermaid = (ele) => {
    window.loadMermaid = true
    const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'dark' : 'default'

    Array.from(ele).forEach((item, index) => {
      const mermaidSrc = item.firstElementChild
      const mermaidThemeConfig = '%%{init:{ \'theme\':\'' + theme + '\'}}%%\n'
      const mermaidID = 'mermaid-' + index
      const mermaidDefinition = mermaidThemeConfig + mermaidSrc.textContent

      const renderFn = mermaid.render(mermaidID, mermaidDefinition)

      const renderV10 = () => {
        renderFn.then(({svg}) => {
          mermaidSrc.insertAdjacentHTML('afterend', svg)
        })
      }

      const renderV9 = svg => {
        mermaidSrc.insertAdjacentHTML('afterend', svg)
      }

      typeof renderFn === 'string' ? renderV9(renderFn) : renderV10()
    })
  }

  const codeToMermaid = () => {
    const codeMermaidEle = document.querySelectorAll('pre > code.mermaid')
    if (codeMermaidEle.length === 0) return
    
    codeMermaidEle.forEach(ele => {
      const newEle = document.createElement('div')
      newEle.className = 'mermaid-wrap'
      newEle.innerHTML = `<pre class="mermaid-src" hidden>${ele.textContent}</pre>`
      ele.parentNode.replaceWith(newEle)
    })
  }

  const loadMermaid = () => {
    if (false) codeToMermaid()
    const $mermaid = document.querySelectorAll('#article-container .mermaid-wrap')
    if ($mermaid.length === 0) return

    const runMermaidFn = () => runMermaid($mermaid)
    btf.addGlobalFn('themeChange', runMermaidFn, 'mermaid')
    window.loadMermaid ? runMermaidFn() : btf.getScript('https://cdn.jsdelivr.net/npm/mermaid@10.9.0/dist/mermaid.min.js').then(runMermaidFn)
  }
  
  btf.addGlobalFn('encrypt', loadMermaid, 'mermaid')
  window.pjax ? loadMermaid() : document.addEventListener('DOMContentLoaded', loadMermaid)
})()</script></div><script defer="" src="https://cdn.jsdelivr.net/gh/CodeByZach/pace/pace.min.js"></script> - <script defer="" src="/js/custom/MemorialDayMode.js"></script><script id="canvas_nest" defer="defer" color="0,0,255" opacity="0.7" zindex="-1" count="99" mobile="true" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/dist/canvas-nest.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = true;
POWERMODE.mobile = true;
document.body.addEventListener('input', POWERMODE);
</script><script id="click-heart" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/dist/click-heart.min.js" async="async" mobile="false"></script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer@1.10.1/dist/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/aplayer@1.10.1/dist/APlayer.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/metingjs/dist/Meting.min.js"></script><script>(() => {
  const destroyAplayer = () => {
    if (window.aplayers) {
      for (let i = 0; i < window.aplayers.length; i++) {
        if (!window.aplayers[i].options.fixed) {
          window.aplayers[i].destroy()
        }
      }
    }
  }

  const loadMeting = () => {
    typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()
  }

  btf.addGlobalFn('pjaxSend', destroyAplayer, 'destroyAplayer')
  btf.addGlobalFn('pjaxComplete', loadMeting, 'loadMeting')
})()</script><script src="https://cdn.jsdelivr.net/npm/pjax@0.2.8/pjax.min.js"></script><script>let pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]

var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

const triggerPjaxFn = (val) => {
  if (!val) return
  Object.values(val).forEach(fn => { fn() })
}

document.addEventListener('pjax:send', function () {

  // removeEventListener
  btf.removeGlobalFnEvent('pjax')
  btf.removeGlobalFnEvent('themeChange')

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')

  triggerPjaxFn(window.globalFn.pjaxSend)
})

document.addEventListener('pjax:complete', () => {
  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  triggerPjaxFn(window.globalFn.pjaxComplete)
})

document.addEventListener('pjax:error', e => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async="" data-pjax="" src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"></div></div><hr><div id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js?v=4.14.0-b3"></script></div></div></body></html>